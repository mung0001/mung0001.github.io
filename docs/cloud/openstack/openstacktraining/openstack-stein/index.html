<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Openstack Stain Manual 설치##1. 시스템 및 네트워크 구성#여기서는 Nat 네트워크를 외부, host1 대역을 내부로 사용하여 Openstack을 구축해보도록 하겠습니다. #운영체제 및 네트워크 구성 Hypervisor : Vmware Workstation 15 OS : CentOS7 #노드 구성 OS Hostname Network Interface Network Interface2 CPU RAM DISK CentOS7 controller Nat ( 192.168.10.100 ) HOST1 ( 10.10.10.10 ) 2cpu 4thread 8 RAm 30G CentOS7 natwork Nat ( 192.168.10.101 ) HOST1 ( 10.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Openstack Stain Manual 설치" />
<meta property="og:description" content="Openstack Stain Manual 설치##1. 시스템 및 네트워크 구성#여기서는 Nat 네트워크를 외부, host1 대역을 내부로 사용하여 Openstack을 구축해보도록 하겠습니다. #운영체제 및 네트워크 구성 Hypervisor : Vmware Workstation 15 OS : CentOS7 #노드 구성 OS Hostname Network Interface Network Interface2 CPU RAM DISK CentOS7 controller Nat ( 192.168.10.100 ) HOST1 ( 10.10.10.10 ) 2cpu 4thread 8 RAm 30G CentOS7 natwork Nat ( 192.168.10.101 ) HOST1 ( 10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mung0001.github.io/docs/cloud/openstack/openstacktraining/openstack-stein/" /><meta property="article:section" content="docs" />


<title>Openstack Stain Manual 설치 | 뭉게뭉게</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.0c9093ccbc8f6748958394c44f1e010f462c4e028bf810a740c6c1691b994bb3.css" integrity="sha256-DJCTzLyPZ0iVg5TETx4BD0YsTgKL&#43;BCnQMbBaRuZS7M=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.ffcce1416ac965bf6815bf4bdd99cf970182cd6ac9b30c72a81407197d550a70.js" integrity="sha256-/8zhQWrJZb9oFb9L3ZnPlwGCzWrJswxyqBQHGX1VCnA=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4274477834047595"
     crossorigin="anonymous"></script>


<meta name="msvalidate.01" content="06459B812189FBCB7F3B235A75505BD4" />

</head>
<body>
  <div class="background">
    <input type="checkbox" class="hidden toggle" id="menu-control" />
    <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex" style="max-width:100%;" >
    
    <aside style="padding-left: 1em;" class="book-menu">
      <div class="book-menu-content">
      
  
<nav styles="background-color:red; position=none;">
구름이 
<h2 class="book-brand">
  <a href="/"><span>뭉게뭉게</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  

  
  




 
  
    




  
  <ul>
    
      
        

  <li class="book-section-flat" >
    

  
  <a href="/docs/infra/" class="">Infra</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/infra/hardware/" class="collapsed ">HardWare</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/infra/idc/" class="collapsed ">IDC</a>
  


    






  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <a href="/docs/infra/monitoring/" class="">Monitoring</a>
  


    




  
  <ul>
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Docker</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/docker/docker/" class="collapsed ">Docker docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/docker/dockertraining/" class="collapsed ">Docker Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>System</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/system/linux/" class="collapsed ">Linux</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/system/" class="collapsed ">OS</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/window/" class="collapsed ">Windows Servers</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/macos/" class="collapsed ">Mac OS</a>
  


    






  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>development</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/system/development/python/" class="collapsed ">Python docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/development/shell/" class="collapsed ">Shell Script</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/development/spingboot/" class="collapsed ">Sping Boot</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/development/golang/" class="collapsed ">Golang</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/development/web/" class="collapsed ">Web</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/development/git/" class="collapsed ">Git</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Network</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/system/network/network/" class="collapsed ">Network 기본</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/network/sophos/" class="collapsed ">Sophos</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/network/snort/" class="collapsed ">Snort</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/network/nm/" class="collapsed ">Network Master</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Database</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/database/sqld/" class="collapsed ">SQLP&amp; SQLD</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  



















</nav>






 
    </aside>



    
    <div style="padding-left: 2%;" class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Openstack Stain Manual 설치</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-시스템-및-네트워크-구성"><strong>1. 시스템 및 네트워크 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#2-openstack-기본-패키지-구성"><strong>2. Openstack 기본 패키지 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#3-keystone--인증-서비스--구성"><strong>3. Keystone ( 인증 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#4-glance--이미지-서비스--구성"><strong>4. Glance ( 이미지 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#5-nova--컴퓨트-서비스--구성"><strong>5. Nova ( 컴퓨트 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#6-neutron--네트워크-서비스--구성"><strong>6. Neutron ( 네트워크 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#7-horizon--대시보드-서비스--구성"><strong>7. Horizon ( 대시보드 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-cinder--오브젝트-스토리지-및-블록-스토리지-구성-"><strong>8. Cinder ( 오브젝트 스토리지 및 블록 스토리지 구성 )</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-2-lvm으로-블록-스토리지-백엔드-구성"><strong>8-2. LVM으로 블록 스토리지 백엔드 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-3-lbaas-설치"><strong>8-3. LBaaS 설치</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-4-lfs-lvm-기반-다중-스토리지-노드-구성"><strong>8-4. LFS, LVM 기반 다중 스토리지 노드 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#9-swift--오브젝트-스토리지-서비스--구성"><strong>9. Swift ( 오브젝트 스토리지 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#10-heat--orchestration--설치"><strong>10. Heat ( Orchestration ) 설치</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#11-openstack-대시보드-메인-로고-및-링크-변경"><strong>11. Openstack 대시보드 메인 로고 및 링크 변경</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#12-neutron-기반-service-functon-chaining--sfc--기능-구성"><strong>12. Neutron 기반 Service Functon Chaining ( SFC ) 기능 구성</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      <div>
<ins class="kakao_ad_area" style="display:none;" 
 data-ad-unit    = "DAN-ICAYRM98zmyBXxtc" 
 data-ad-width   = "320" 
 data-ad-height  = "100"></ins> 
<script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
</div>
<br>
<br>
<script src="https://ads-partners.coupang.com/g.js"></script>
<script>
    new PartnersCoupang.G({"id":402713,"trackingCode":"AF0817069","subId":null,"template":"carousel","width":"680","height":"140"});
</script>
<br>
<br>
<br>
      
  <article class="markdown"><h1 id="openstack-stain-manual-설치">
  <strong>Openstack Stain Manual 설치</strong>
  <a class="anchor" href="#openstack-stain-manual-%ec%84%a4%ec%b9%98">#</a>
</h1>
<hr>
<p> </p>
<h1 id="heading">
  
  <a class="anchor" href="#heading">#</a>
</h1>
<h3 id="1-시스템-및-네트워크-구성">
  <strong>1. 시스템 및 네트워크 구성</strong>
  <a class="anchor" href="#1-%ec%8b%9c%ec%8a%a4%ed%85%9c-%eb%b0%8f-%eb%84%a4%ed%8a%b8%ec%9b%8c%ed%81%ac-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>여기서는 Nat 네트워크를 외부, host1 대역을 내부로 사용하여 Openstack을 구축해보도록 하겠습니다.</strong></li>
</ul>
<h1 id="heading-1">
  
  <a class="anchor" href="#heading-1">#</a>
</h1>
<ul>
<li><strong>운영체제 및 네트워크 구성</strong>
<ul>
<li><strong>Hypervisor : Vmware Workstation 15</strong></li>
<li><strong>OS : CentOS7</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-2">
  
  <a class="anchor" href="#heading-2">#</a>
</h1>
<ul>
<li><strong>노드 구성</strong></li>
</ul>
<table>
<thead>
<tr>
<th>OS</th>
<th>Hostname</th>
<th>Network Interface</th>
<th>Network Interface2</th>
<th>CPU</th>
<th>RAM</th>
<th>DISK</th>
</tr>
</thead>
<tbody>
<tr>
<td>CentOS7</td>
<td>controller</td>
<td>Nat ( 192.168.10.100 )</td>
<td>HOST1 ( 10.10.10.10 )</td>
<td>2cpu 4thread</td>
<td>8 RAm</td>
<td>30G</td>
</tr>
<tr>
<td>CentOS7</td>
<td>natwork</td>
<td>Nat ( 192.168.10.101 )</td>
<td>HOST1 ( 10.10.10.20 )</td>
<td>1cpu 2thread</td>
<td>2 RAm</td>
<td>20G</td>
</tr>
<tr>
<td>CentOS7</td>
<td>compute</td>
<td>Nat ( 192.168.10.102 )</td>
<td>HOST1 ( 10.10.10.30 )</td>
<td>1cpu 4thread</td>
<td>4 RAm</td>
<td>100G</td>
</tr>
</tbody>
</table>
<h1 id="heading-3">
  
  <a class="anchor" href="#heading-3">#</a>
</h1>
<ul>
<li><strong>기본적인 업데이트 및 설정을 모든 노드에 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y update
</span></span><span style="display:flex;"><span># 업데이트
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/hosts
</span></span><span style="display:flex;"><span>10.10.10.10 controller
</span></span><span style="display:flex;"><span>10.10.10.20 network
</span></span><span style="display:flex;"><span>10.10.10.30 compute
</span></span><span style="display:flex;"><span># known host 등록
</span></span></code></pre></div><h1 id="heading-4">
  
  <a class="anchor" href="#heading-4">#</a>
</h1>
<ul>
<li><strong>설정이 완료되면 기본 구성을 모든 노드에 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y install chrony
</span></span><span style="display:flex;"><span># 시간 동기화를 위한 chrony 설치
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/chrony.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#server 0.centos.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>#server 1.centos.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>#server 2.centos.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>#server 3.centos.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>server ntp1.jst.mfeed.ad.jp iburst
</span></span><span style="display:flex;"><span>server ntp2.jst.mfeed.ad.jp iburst
</span></span><span style="display:flex;"><span>server ntp3.jst.mfeed.ad.jp iburst
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>allow 10.10.10.0/24
</span></span><span style="display:flex;"><span># 시간동기화
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-service=ntp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># ntp 방화벽 허용 및 리로딩
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ init 6
</span></span><span style="display:flex;"><span># 시스템 재시작
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chronyc sources
</span></span><span style="display:flex;"><span># 확인
</span></span></code></pre></div><h1 id="heading-5">
  
  <a class="anchor" href="#heading-5">#</a>
</h1>
<p> </p>
<h1 id="heading-6">
  
  <a class="anchor" href="#heading-6">#</a>
</h1>
<h3 id="2-openstack-기본-패키지-구성">
  <strong>2. Openstack 기본 패키지 구성</strong>
  <a class="anchor" href="#2-openstack-%ea%b8%b0%eb%b3%b8-%ed%8c%a8%ed%82%a4%ec%a7%80-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Openstack의 기본 패키지 구성은 먼저 contorller 노드만을 통해 진행됨을 유의해주시길 바랍니다.</strong></li>
<li><strong>controller 노드에는 다음의 패키지가 설치됩니다.</strong>
<ul>
<li><strong>MariaDB: OpenStack 서비스 및 VM 관련 설정들을 보관하기 위해 사용</strong></li>
<li><strong>RabbitMQ: OpenStack 서비스 간 상호 메시지를 주고 받기 위하나 메시지 큐로 사용</strong></li>
<li><strong>Memcached: 범용 분산 메모리 캐시 시스템으로, 자주 외부 데이터에 접근해야 하는 경우에 발생하는 오버헤드를 줄이기 위해 메모리르르 캐싱하고 읽어들이는 역할을 담당, OpenStack 서비스에서는 주로 인증 메커니즘에서 토큰 캐싱을 위해 사용됩니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-7">
  
  <a class="anchor" href="#heading-7">#</a>
</h1>
<ul>
<li><strong>Openstack 패키지 설치 및 레포지토리 구성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y install centos-release-openstack-stein
</span></span><span style="display:flex;"><span>$ sed -i -e &#34;s/enabled=1/enabled=0/g&#34; /etc/yum.repos.d/CentOS-OpenStack-stein.repo
</span></span><span style="display:flex;"><span># stein 패캐지를 등록합니다.
</span></span></code></pre></div><h1 id="heading-8">
  
  <a class="anchor" href="#heading-8">#</a>
</h1>
<ul>
<li><strong>MariaDB를 설치합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install mariadb-server
</span></span><span style="display:flex;"><span>$ vi /etc/my.cnf
</span></span><span style="display:flex;"><span>[mysqld]
</span></span><span style="display:flex;"><span>character-set-server=utf8
</span></span><span style="display:flex;"><span># charset을 utf-8으로 변경합니다
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start mariadb
</span></span><span style="display:flex;"><span>$ systemctl enable mariadb
</span></span><span style="display:flex;"><span># mariadb을 시작 및 자동시작을 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mysql_secure_installation
</span></span><span style="display:flex;"><span># 패스워드 설정을 진행합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-service=mysql --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-9">
  
  <a class="anchor" href="#heading-9">#</a>
</h1>
<ul>
<li><strong>RabbitMQ 및 Memcached를 설치합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install rabbitmq-server
</span></span><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install memcached
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/my.cnf.d/mariadb-server.cnf
</span></span><span style="display:flex;"><span>[mysqld]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>character-set-server=utf8
</span></span><span style="display:flex;"><span>max_connections=500
</span></span><span style="display:flex;"><span># Mariadb의 위에 내용을 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/sysconfig/memcached
</span></span><span style="display:flex;"><span>OPTIONS=&#34;-l 0.0.0.0,::&#34;
</span></span><span style="display:flex;"><span># mamcached를 모든 리스닝 상태로 전환시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart mariadb rabbitmq-server memcached
</span></span><span style="display:flex;"><span>$ systemctl enable mariadb rabbitmq-server memcached
</span></span><span style="display:flex;"><span># Mariadb와 함께 RabbitMQ 및 Memcached를 시작 및 자동시작을 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl add_user [ id ] [ pw ]
</span></span><span style="display:flex;"><span># rabbitmq 유저를 생성합니다. 여기서는 openstack/qwer1234를 사용하도록 하겠습니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rabbitmqctl set_permissions [ id ] &#34;.*&#34; &#34;.*&#34; &#34;.*&#34;
</span></span><span style="display:flex;"><span># 생성한 사용자에게 모든 권한을 부여합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=<span style="color:#75715e">{</span><span style="color:#ae81ff">11211</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">5672</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#75715e">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-10">
  
  <a class="anchor" href="#heading-10">#</a>
</h1>
<p> </p>
<h1 id="heading-11">
  
  <a class="anchor" href="#heading-11">#</a>
</h1>
<h3 id="3-keystone--인증-서비스--구성">
  <strong>3. Keystone ( 인증 서비스 ) 구성</strong>
  <a class="anchor" href="#3-keystone--%ec%9d%b8%ec%a6%9d-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Keystone 또한 controller의 설치를 진행합니다.</strong></li>
<li><strong>keystone에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/keystone/">keystone</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-12">
  
  <a class="anchor" href="#heading-12">#</a>
</h1>
<ul>
<li><strong>keyston DB 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database keystone;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on keystone.* to keystone@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on keystone.* to keystone@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span># keystone 구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-13">
  
  <a class="anchor" href="#heading-13">#</a>
</h1>
<ul>
<li><strong>keystone 패키지 설치 및 수정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-keystone openstack-utils python-openstackclient httpd mod_wsgi
</span></span><span style="display:flex;"><span># keystone 및 관련 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/keystone/keystone.conf
</span></span><span style="display:flex;"><span>[cache]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>memcache_servers = controller:11211
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://keystone:qwer1234@controller/keystone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[token]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>provider = fernet
</span></span><span style="display:flex;"><span># keystone 구성을 위해 설정파일 수정합니다.
</span></span><span style="display:flex;"><span># hosts에 등록한 IP 혹은 controller의 IP를 기입하셔도 무관합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/bash keystone -c &#34;keystone-manage db_sync&#34;
</span></span><span style="display:flex;"><span># 설정 값을 토대로 db의 설정을 저정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
</span></span><span style="display:flex;"><span>$ keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
</span></span><span style="display:flex;"><span># 토큰 및 자격 증명 암호화를 위해 사용되는 키 저장소를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export controller=10.10.10.10
</span></span><span style="display:flex;"><span>$ keystone-manage bootstrap --bootstrap-password qwer1234 \
</span></span><span style="display:flex;"><span>--bootstrap-admin-url http://$controller:5000/v3/ \
</span></span><span style="display:flex;"><span>--bootstrap-internal-url http://$controller:5000/v3/ \
</span></span><span style="display:flex;"><span>--bootstrap-public-url http://$controller:5000/v3/ \
</span></span><span style="display:flex;"><span>--bootstrap-region-id RegionOne
</span></span><span style="display:flex;"><span># controlelr의 IP로 keystone을 부트스트랩합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ setsebool -P httpd_use_openstack on
</span></span><span style="display:flex;"><span>$ setsebool -P httpd_can_network_connect on
</span></span><span style="display:flex;"><span>$ setsebool -P httpd_can_network_connect_db on
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=5000/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># Selinux와 방화벽으르 설정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/
</span></span><span style="display:flex;"><span>$ systemctl start httpd
</span></span><span style="display:flex;"><span>$ systemctl enable httpd
</span></span><span style="display:flex;"><span># keystone 설정 활성화 및 httpd 를 시작합니다.
</span></span></code></pre></div><h1 id="heading-14">
  
  <a class="anchor" href="#heading-14">#</a>
</h1>
<ul>
<li><strong>정상 동작 확인을 위한 토큰 파일 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi ~/admin
</span></span><span style="display:flex;"><span>export OS_PROJECT_DOMAIN_NAME=default
</span></span><span style="display:flex;"><span>export OS_USER_DOMAIN_NAME=default
</span></span><span style="display:flex;"><span>export OS_PROJECT_NAME=admin
</span></span><span style="display:flex;"><span>export OS_USERNAME=admin
</span></span><span style="display:flex;"><span>export OS_PASSWORD=qwer1234
</span></span><span style="display:flex;"><span>export OS_AUTH_URL=http://controller:5000/v3
</span></span><span style="display:flex;"><span>export OS_IDENTITY_API_VERSION=3
</span></span><span style="display:flex;"><span>export OS_IMAGE_API_VERSION=2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod 600 ~/admin
</span></span><span style="display:flex;"><span>$ source ~/admin
</span></span></code></pre></div><h1 id="heading-15">
  
  <a class="anchor" href="#heading-15">#</a>
</h1>
<ul>
<li><strong>project 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ cd ~
</span></span><span style="display:flex;"><span>$ . admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack project create --domain default --description &#34;Service Project&#34; service
</span></span><span style="display:flex;"><span>+-------------+----------------------------------+
</span></span><span style="display:flex;"><span>| Field       | Value                            |
</span></span><span style="display:flex;"><span>+-------------+----------------------------------+
</span></span><span style="display:flex;"><span>| description | Service Project                  |
</span></span><span style="display:flex;"><span>| domain_id   | default                          |
</span></span><span style="display:flex;"><span>| enabled     | True                             |
</span></span><span style="display:flex;"><span>| id          | 3f0b3ef5b8c94a0a9cca8e34ea2fdbd6 |
</span></span><span style="display:flex;"><span>| is_domain   | False                            |
</span></span><span style="display:flex;"><span>| name        | service                          |
</span></span><span style="display:flex;"><span>| parent_id   | default                          |
</span></span><span style="display:flex;"><span>| tags        | []                               |
</span></span><span style="display:flex;"><span>+-------------+----------------------------------+
</span></span><span style="display:flex;"><span># project 생성
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack project list
</span></span><span style="display:flex;"><span>+----------------------------------+---------+
</span></span><span style="display:flex;"><span>| ID                               | Name    |
</span></span><span style="display:flex;"><span>+----------------------------------+---------+
</span></span><span style="display:flex;"><span>| 3f0b3ef5b8c94a0a9cca8e34ea2fdbd6 | service |
</span></span><span style="display:flex;"><span>| ec1a4336cfa64d04bbc8f908b26a6cda | admin   |
</span></span><span style="display:flex;"><span>+----------------------------------+---------+
</span></span></code></pre></div><h1 id="heading-16">
  
  <a class="anchor" href="#heading-16">#</a>
</h1>
<ul>
<li><strong>이것으로 keystone에 대한 설치가 끝났습니다.</strong></li>
<li><strong>혹시 오류가 발생할 경우 /var/log/keystone/ 혹은 /var/log/httpd/에서 error 로그, keystone 로그를 검색하여 오류를 찾아내시면 보다 쉽게 문제를 해결하실 수 있습니다.</strong></li>
</ul>
<h1 id="heading-17">
  
  <a class="anchor" href="#heading-17">#</a>
</h1>
<p> </p>
<h1 id="heading-18">
  
  <a class="anchor" href="#heading-18">#</a>
</h1>
<h3 id="4-glance--이미지-서비스--구성">
  <strong>4. Glance ( 이미지 서비스 ) 구성</strong>
  <a class="anchor" href="#4-glance--%ec%9d%b4%eb%af%b8%ec%a7%80-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Glance 또한 controller에서만 설치를 진행합니다.</strong></li>
<li><strong>에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/glance/">Glance</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-19">
  
  <a class="anchor" href="#heading-19">#</a>
</h1>
<ul>
<li><strong>glance 사용자 추가</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ source ~/admin
</span></span><span style="display:flex;"><span># 전에 생성했던 토큰 값을 적용합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 glance
</span></span><span style="display:flex;"><span># glance 게정을 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user glance admin
</span></span><span style="display:flex;"><span># glance에 admin의 권한을 부여합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack service create --name glance --description &#34;OpenStack Image service&#34; image
</span></span><span style="display:flex;"><span># glance 서비스 엔트리를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export controller=10.10.10.10
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne image public http://$controller:9292
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne image internal http://$controller:9292
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne image admin http://$controller:9292
</span></span><span style="display:flex;"><span># glance 서비스의 endpoint를 추가합니다 ( public, internal, admin )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack user list
</span></span><span style="display:flex;"><span>+----------------------------------+--------+
</span></span><span style="display:flex;"><span>| ID                               | Name   |
</span></span><span style="display:flex;"><span>+----------------------------------+--------+
</span></span><span style="display:flex;"><span>| bd36365f2459468a9c480cb48bab3ac0 | glance |
</span></span><span style="display:flex;"><span>| e19db9d5ec2c4c30b7a85d18b8b0e589 | admin  |
</span></span><span style="display:flex;"><span>+----------------------------------+--------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack endpoint list
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+
</span></span><span style="display:flex;"><span>| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                         |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+
</span></span><span style="display:flex;"><span>| 00b38774cef048ee9950eda6938accc3 | RegionOne | keystone     | identity     | True    | public    | http://10.10.10.10:5000/v3/ |
</span></span><span style="display:flex;"><span>| 4591b06391374fe888380fa23b8f5121 | RegionOne | glance       | image        | True    | admin     | http://10.10.10.10:9292                |
</span></span><span style="display:flex;"><span>| 53dd31fecf2d44949c141149a13c673b | RegionOne | keystone     | identity     | True    | admin     | http://10.10.10.10:5000/v3/ |
</span></span><span style="display:flex;"><span>| 555f3d900f7e416bb783120f7ce74fe8 | RegionOne | glance       | image        | True    | internal  | http://10.10.10.10:9292                |
</span></span><span style="display:flex;"><span>| 5b3ac620bb7d4d9aabdf0f33229ee346 | RegionOne | glance       | image        | True    | public    | http://10.10.10.10:9292                |
</span></span><span style="display:flex;"><span>| bdd7df7c8cba46f6ada2c12155a9f1d6 | RegionOne | keystone     | identity     | True    | internal  | http://10.10.10.10:5000/v3/ |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+--------------+--------------+---------+-----------+-----------------------------+
</span></span></code></pre></div><ul>
<li><strong>Glance DB 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database glance;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on glance.* to glance@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on glance.* to glance@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span>#  구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-20">
  
  <a class="anchor" href="#heading-20">#</a>
</h1>
<ul>
<li><strong>glance 패키지 설치 및 수정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-glance
</span></span><span style="display:flex;"><span># glance 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/glance/glance-api.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>bind_host = 0.0.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[glance_store]
</span></span><span style="display:flex;"><span>stores = file,http
</span></span><span style="display:flex;"><span>default_store = file
</span></span><span style="display:flex;"><span>filesystem_store_datadir = /var/lib/glance/images/ # 이미지 경로 지정
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]  # database 연동
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://glance:qwer1234@controller/glance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]  # keystone 인증
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = glance
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[paste_deploy]
</span></span><span style="display:flex;"><span>flavor = keystone
</span></span><span style="display:flex;"><span># glance.conf를 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/bash glance -c &#34;glance-manage db_sync&#34;
</span></span><span style="display:flex;"><span># glance db를 동기화 시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start openstack-glance-api
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-glance-api
</span></span><span style="display:flex;"><span># glance를 시작 및 실행시 자동시작을 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ setsebool -P glance_api_can_network on
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=9292/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># Selinux 및 firewall을 설정합니다.
</span></span></code></pre></div><h1 id="heading-21">
  
  <a class="anchor" href="#heading-21">#</a>
</h1>
<ul>
<li><strong>확인을 위한 이미지 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ wget http://download.cirros-cloud.net/0.5.1/cirros-0.5.1-x86_64-disk.img
</span></span><span style="display:flex;"><span># 확인을 위해 cirros 이미지를 다운 받습니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack image create &#34;Cirros&#34; --file cirros-0.5.1-x86_64-disk.img --disk-format qcow2
</span></span><span style="display:flex;"><span># image 등록
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack image list
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+
</span></span><span style="display:flex;"><span>| ID                                   | Name   | Status |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+
</span></span><span style="display:flex;"><span>| 38e15009-022b-49ce-bcdf-b220eb3c5b12 | Cirros | active |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+
</span></span><span style="display:flex;"><span># 확인
</span></span></code></pre></div><h1 id="heading-22">
  
  <a class="anchor" href="#heading-22">#</a>
</h1>
<p> </p>
<h1 id="heading-23">
  
  <a class="anchor" href="#heading-23">#</a>
</h1>
<h3 id="5-nova--컴퓨트-서비스--구성">
  <strong>5. Nova ( 컴퓨트 서비스 ) 구성</strong>
  <a class="anchor" href="#5-nova--%ec%bb%b4%ed%93%a8%ed%8a%b8-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Nova 서비스는 controller 노드와 compute노드에 구성됩니다.</strong></li>
<li><strong>설치는 contoller &gt; compute 순으로 진행하도록 하겠습니다.</strong></li>
<li><strong>Nova에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/nova/">Nova</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-24">
  
  <a class="anchor" href="#heading-24">#</a>
</h1>
<ul>
<li><strong>Nova, Placement 추가 및 등록</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ source ~/admin
</span></span><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 nova
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user nova admin
</span></span><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 placement
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user placement admin
</span></span><span style="display:flex;"><span># nova 유저와 placement유저를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack service create --name nova --description &#34;OpenStack Compute Service&#34; compute
</span></span><span style="display:flex;"><span># nova 서버 엔트리 저장
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack service create --name placement --description &#34;OpenStack Compute Placement Service&#34; placement
</span></span><span style="display:flex;"><span># placement 서버 엔트리 저장
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack user list
</span></span><span style="display:flex;"><span># 확인
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+
</span></span><span style="display:flex;"><span>| ID                               | Name      |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+
</span></span><span style="display:flex;"><span>| 18bdf3e68a754aa182f93196a918ba65 | nova      |
</span></span><span style="display:flex;"><span>| 18ff8b52493a408d9933596ed20cca9c | glance    |
</span></span><span style="display:flex;"><span>| bfd0cf6d358e49bf88f183a463c689a2 | placement |
</span></span><span style="display:flex;"><span>| e19db9d5ec2c4c30b7a85d18b8b0e589 | admin     |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export controller=10.10.10.10
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne compute public http://$controller:8774/v2.1/%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne compute internal http://$controller:8774/v2.1/%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne compute admin http://$controller:8774/v2.1/%\(tenant_id\)s
</span></span><span style="display:flex;"><span># nova 서비스의 endpoint를 추가합니다
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne placement public http://$controller:8778
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne placement internal http://$controller:8778
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne placement admin http://$controller:8778
</span></span><span style="display:flex;"><span>$ placement의 endpoint를 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack endpoint list
</span></span><span style="display:flex;"><span># 확인
</span></span><span style="display:flex;"><span>-------+-----------+--------------------------------------------+
</span></span><span style="display:flex;"><span>| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                                        |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+--------------+--------------+---------+-----------+--------------------------------------------+
</span></span><span style="display:flex;"><span>| 00b38774cef048ee9950eda6938accc3 | RegionOne | keystone     | identity     | True    | public    | http://10.10.10.10:5000/v3/                |
</span></span><span style="display:flex;"><span>| 04ca5fb6701348089777d68a68ca7cd2 | RegionOne | placement    | placement    | True    | public    | http://10.10.10.10:8778                    |
</span></span><span style="display:flex;"><span>| 53ad55ce8897463b86ea616a8ba64d95 | RegionOne | glance       | image        | True    | public    | http://10.10.10.10:9292                    |
</span></span><span style="display:flex;"><span>| 53dd31fecf2d44949c141149a13c673b | RegionOne | keystone     | identity     | True    | admin     | http://10.10.10.10:5000/v3/                |
</span></span><span style="display:flex;"><span>| 595a2045543b42c2bb6f23e2dd30a3bb | RegionOne | glance       | image        | True    | internal  | http://10.10.10.10:9292                    |
</span></span><span style="display:flex;"><span>| 6820b49138d54b63ac34cd52f1be08f6 | RegionOne | placement    | placement    | True    | internal  | http://10.10.10.10:8778                    |
</span></span><span style="display:flex;"><span>| 6ad740445fca4a0fb684d913909fe129 | RegionOne | nova         | compute      | True    | admin     | http://10.10.10.10:8774/v2.1/%(tenant_id)s |
</span></span><span style="display:flex;"><span>| 9863826e093943cf97a05dfc6e3c159a | RegionOne | nova         | compute      | True    | internal  | http://10.10.10.10:8774/v2.1/%(tenant_id)s |
</span></span><span style="display:flex;"><span>| b9f9701a57ec40e487ce493a63903cae | RegionOne | placement    | placement    | True    | admin     | http://10.10.10.10:8778                    |
</span></span><span style="display:flex;"><span>| bd787b85b3124f0ab15854998624cb19 | RegionOne | nova         | compute      | True    | public    | http://10.10.10.10:8774/v2.1/%(tenant_id)s |
</span></span><span style="display:flex;"><span>| bdd7df7c8cba46f6ada2c12155a9f1d6 | RegionOne | keystone     | identity     | True    | internal  | http://10.10.10.10:5000/v3/                |
</span></span><span style="display:flex;"><span>| d394eaf13ac840b3b2e69e074c2c1c20 | RegionOne | glance       | image        | True    | admin     | http://10.10.10.10:9292                    |
</span></span><span style="display:flex;"><span>+----------------------------------+-----------+--------------+--------------+---------+-----------+--------------------------------------------+
</span></span></code></pre></div><h1 id="heading-25">
  
  <a class="anchor" href="#heading-25">#</a>
</h1>
<ul>
<li><strong>Nova DB 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database nova;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova.* to nova@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova.* to nova@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database nova_api;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_api.* to nova@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_api.* to nova@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database nova_placement;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_placement.* to nova@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_placement.* to nova@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database nova_cell0;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_cell0.* to nova@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on nova_cell0.* to nova@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span>#  nova 구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-26">
  
  <a class="anchor" href="#heading-26">#</a>
</h1>
<ul>
<li><strong>nova 서비스를 설치 및 수정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-nova
</span></span><span style="display:flex;"><span># nova 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>my_ip = 10.10.10.10
</span></span><span style="display:flex;"><span>state_path = /var/lib/nova
</span></span><span style="display:flex;"><span>enabled_apis = osapi_compute,metadata
</span></span><span style="display:flex;"><span>log_dir = /var/log/nova
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[api]
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[glance]
</span></span><span style="display:flex;"><span>api_servers = http://controller:9292
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[api_database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://nova:qwer1234@controller/nova_api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://nova:qwer1234@controller/nova
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = nova
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[placement]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>os_region_name = RegionOne
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = placement
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[placement_database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://nova:qwer1234@controller/nova_placement
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[wsgi]
</span></span><span style="display:flex;"><span>api_paste_config = /etc/nova/api-paste.ini
</span></span><span style="display:flex;"><span># nova의 설정 파일을 수정합니다.
</span></span></code></pre></div><h1 id="heading-27">
  
  <a class="anchor" href="#heading-27">#</a>
</h1>
<ul>
<li><strong>Selinux 및 firewalld을 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ semanage port -a -t http_port_t -p tcp 8778
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=<span style="color:#75715e">{</span><span style="color:#ae81ff">6080</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6081</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6082</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8774</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8775</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8778</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#75715e">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-28">
  
  <a class="anchor" href="#heading-28">#</a>
</h1>
<ul>
<li><strong>nova 서비스를 DB에 저장합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ su -s /bin/bash nova -c &#34;nova-manage api_db sync&#34;
</span></span><span style="display:flex;"><span>$ su -s /bin/bash nova -c &#34;nova-manage cell_v2 map_cell0&#34;
</span></span><span style="display:flex;"><span>$ su -s /bin/bash nova -c &#34;nova-manage db sync&#34;
</span></span><span style="display:flex;"><span>$ su -s /bin/bash nova -c &#34;nova-manage cell_v2 create_cell --name cell1&#34;
</span></span></code></pre></div><h1 id="heading-29">
  
  <a class="anchor" href="#heading-29">#</a>
</h1>
<ul>
<li><strong>nova 서비스를 시작 및 자동시작을 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ systemctl restart httpd
</span></span><span style="display:flex;"><span>$ chown nova. /var/log/nova/nova-placement-api.log
</span></span><span style="display:flex;"><span>$ for service in api consoleauth conductor scheduler novncproxy; do
</span></span><span style="display:flex;"><span>systemctl start openstack-nova-$service
</span></span><span style="display:flex;"><span>systemctl enable openstack-nova-$service
</span></span><span style="display:flex;"><span>done
</span></span></code></pre></div><ul>
<li><strong>이상으로 controller 노드에서의 구성을 마치겠습니다.</strong></li>
<li><strong>하단부터의 패키지 설치는 compute노드에서 진행해주세요</strong></li>
</ul>
<h1 id="heading-30">
  
  <a class="anchor" href="#heading-30">#</a>
</h1>
<p> </p>
<h1 id="heading-31">
  
  <a class="anchor" href="#heading-31">#</a>
</h1>
<ul>
<li><strong>Stein 레포지터리를 활성화합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y install centos-release-openstack-stein
</span></span><span style="display:flex;"><span>$ sed -i -e &#34;s/enabled=1/enabled=0/g&#34; /etc/yum.repos.d/CentOS-OpenStack-stein.repo
</span></span><span style="display:flex;"><span># stein 패캐지를 등록합니다.
</span></span></code></pre></div><h1 id="heading-32">
  
  <a class="anchor" href="#heading-32">#</a>
</h1>
<ul>
<li><strong>KVM 하이퍼바이저를 구성합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y install qemu-kvm libvirt virt-install bridge-utils
</span></span><span style="display:flex;"><span># KVM 구성에 필요한 가상화 및 네트워크 도구들을 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ lsmod | grep kvm
</span></span><span style="display:flex;"><span># 확인
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start libvirtd
</span></span><span style="display:flex;"><span>$ systenctk ebable libvirtd
</span></span></code></pre></div><h1 id="heading-33">
  
  <a class="anchor" href="#heading-33">#</a>
</h1>
<ul>
<li><strong>compute 노드에 nova 서비스를 설치 및 수정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-nova
</span></span><span style="display:flex;"><span># nova 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>my_ip = 10.10.10.30
</span></span><span style="display:flex;"><span>state_path = /var/lib/nova
</span></span><span style="display:flex;"><span>enabled_apis = osapi_compute,metadata
</span></span><span style="display:flex;"><span>log_dir = /var/log/nova
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[api]
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[vnc]
</span></span><span style="display:flex;"><span>enabled = True
</span></span><span style="display:flex;"><span>server_listen = 0.0.0.0
</span></span><span style="display:flex;"><span>server_proxyclient_address = 192.168.10.102
</span></span><span style="display:flex;"><span>novncproxy_base_url = http://192.168.10.102/vnc_auto.html
</span></span><span style="display:flex;"><span># vnc 화면으르 활성화 합니다. 추후 오픈스택 대시보드 혹은 vnc 클라이언트 프로그램으로 접속할 때 사용합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[glance]
</span></span><span style="display:flex;"><span>api_servers = http://controller:9292
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = nova
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[placement]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>os_region_name = RegionOne
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = placement
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[wsgi]
</span></span><span style="display:flex;"><span>api_paste_config = /etc/nova/api-paste.ini
</span></span><span style="display:flex;"><span># nova의 설정 파일을 수정합니다.
</span></span></code></pre></div><h1 id="heading-34">
  
  <a class="anchor" href="#heading-34">#</a>
</h1>
<ul>
<li><strong>Selinux 및 firewall 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=5900-5999/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-35">
  
  <a class="anchor" href="#heading-35">#</a>
</h1>
<ul>
<li><strong>nova 서비스 시작</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ systemctl start openstack-nova-compute
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-nova-compute
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&amp; controller# openstack compute service list
</span></span><span style="display:flex;"><span># 확인
</span></span><span style="display:flex;"><span>+----+------------------+------------+----------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>| ID | Binary           | Host       | Zone     | Status  | State | Updated At                 |
</span></span><span style="display:flex;"><span>+----+------------------+------------+----------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>|  4 | nova-consoleauth | controller | internal | enabled | up    | 2020-07-19T02:47:16.000000 |
</span></span><span style="display:flex;"><span>|  5 | nova-conductor   | controller | internal | enabled | up    | 2020-07-19T02:47:12.000000 |
</span></span><span style="display:flex;"><span>|  8 | nova-scheduler   | controller | internal | enabled | up    | 2020-07-19T02:47:12.000000 |
</span></span><span style="display:flex;"><span>|  9 | nova-compute     | compute    | nova     | enabled | up    | 2020-07-19T02:47:08.000000 |
</span></span><span style="display:flex;"><span>+----+------------------+------------+----------+---------+-------+----------------------------+
</span></span></code></pre></div><h1 id="heading-36">
  
  <a class="anchor" href="#heading-36">#</a>
</h1>
<p> </p>
<h1 id="heading-37">
  
  <a class="anchor" href="#heading-37">#</a>
</h1>
<h3 id="6-neutron--네트워크-서비스--구성">
  <strong>6. Neutron ( 네트워크 서비스 ) 구성</strong>
  <a class="anchor" href="#6-neutron--%eb%84%a4%ed%8a%b8%ec%9b%8c%ed%81%ac-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Neutron 서비스르르 구성하는 과정에서는 모든 노드에 설치가 진행됩니다.</strong></li>
<li><strong>기본적으로 openvswithch를 중심으로 진행하며, 경우에 따라서는 linuxbridge로 서비스를 대체하는 것이 가능합니다.</strong></li>
<li><strong>설치 과정은 controller, compute, network 노드 순으로 진행하겠습니다.</strong></li>
<li><strong>Neutron에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/neutron/">Neutron</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-38">
  
  <a class="anchor" href="#heading-38">#</a>
</h1>
<ul>
<li><strong>Neutron 사용자 추가</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 neutron
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user neutron admin
</span></span><span style="display:flex;"><span>$ openstack service create --name neutron --description &#34;OpenStack Networking service&#34; network
</span></span><span style="display:flex;"><span># Netutron 사용자를 추가 및 서비스를 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export controller=10.10.10.10
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne network public http://$controller:9696
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne network internal http://$controller:9696
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne network admin http://$controller:9696
</span></span><span style="display:flex;"><span># neutron의 endpoint를 생성합니다.
</span></span></code></pre></div><h1 id="heading-39">
  
  <a class="anchor" href="#heading-39">#</a>
</h1>
<ul>
<li><strong>Neutron DB 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database neutron_ml2;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on neutron_ml2.* to neutron@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on neutron_ml2.* to neutron@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span>#  neutron 구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-40">
  
  <a class="anchor" href="#heading-40">#</a>
</h1>
<ul>
<li><strong>Neutron 설치 및 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron openstack-neutron-ml2
</span></span><span style="display:flex;"><span># neutron 패키지 설치
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>core_plugin = ml2
</span></span><span style="display:flex;"><span>service_plugins = router
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>stae_path = /var/lib/neutron
</span></span><span style="display:flex;"><span>dhcp_agent_notification = True
</span></span><span style="display:flex;"><span>allow_overlapping_ips = True
</span></span><span style="display:flex;"><span>notify_nova_on_port_status_changes = True
</span></span><span style="display:flex;"><span>notify_nova_on_port_data_changes = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://neutron:qwer1234@controller/neutron_ml2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[nova]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>region_name = RegionOne
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = nova
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/metadata_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>nova_metadata_host = controller
</span></span><span style="display:flex;"><span>metadata_proxy_shared_secret = metadata_secret
</span></span><span style="display:flex;"><span>memcache_servers = controller:11211
</span></span><span style="display:flex;"><span># metadata_agent.ini 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types =
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span># ml2_conf.ini 파일에 설정을 수정합니다.
</span></span></code></pre></div><h1 id="heading-41">
  
  <a class="anchor" href="#heading-41">#</a>
</h1>
<ul>
<li><strong>이어 nova.conf 파일에 설정을 추가합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>use_neutron = True
</span></span><span style="display:flex;"><span>linuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver
</span></span><span style="display:flex;"><span>firewall_driver = nova.virt.firewall.NoopFirewallDriver
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[neutron]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>region_name = RegionOne
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>service_metadata_proxy = True
</span></span><span style="display:flex;"><span>metadata_proxy_shared_secret = metadata_secret
</span></span></code></pre></div><h1 id="heading-42">
  
  <a class="anchor" href="#heading-42">#</a>
</h1>
<ul>
<li><strong>Selinux 및 방화벽 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ setsebool -P neutron_can_network on
</span></span><span style="display:flex;"><span>$ setsebool -P daemons_enable_cluster_mode on
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=9696/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># Selinux 및 방화벽을 설정합니다.
</span></span></code></pre></div><h1 id="heading-43">
  
  <a class="anchor" href="#heading-43">#</a>
</h1>
<ul>
<li><strong>Neutron DB를 생성 및 서비스를 시작합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</span></span><span style="display:flex;"><span>$ su -s /bin/bash neutron -c &#34;neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugin.ini upgrade head&#34;
</span></span><span style="display:flex;"><span># Neutron DB를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start neutron-server neutron-metadata-agent
</span></span><span style="display:flex;"><span>$ systemctl enable neutron-server neutron-metadata-agent
</span></span><span style="display:flex;"><span>$ systemctl restart openstack-nova-api
</span></span></code></pre></div><h1 id="heading-44">
  
  <a class="anchor" href="#heading-44">#</a>
</h1>
<p> </p>
<h1 id="heading-45">
  
  <a class="anchor" href="#heading-45">#</a>
</h1>
<ul>
<li><strong>이제 다음으로는 network 노드에 구현해보도록 하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum -y install centos-release-openstack-stein
</span></span><span style="display:flex;"><span>$ sed -i -e &#34;s/enabled=1/enabled=0/g&#34; /etc/yum.repos.d/CentOS-OpenStack-stein.repo
</span></span><span style="display:flex;"><span># stein 패캐지를 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch libibverbs
</span></span><span style="display:flex;"><span># neutron 패키지를 설치합니다.
</span></span></code></pre></div><h1 id="heading-46">
  
  <a class="anchor" href="#heading-46">#</a>
</h1>
<ul>
<li><strong>neutron 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>core_plugin = ml2
</span></span><span style="display:flex;"><span>service_plugins = router
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>stae_path = /var/lib/neutron
</span></span><span style="display:flex;"><span>allow_overlapping_ips = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/l3_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>interface_driver = openvswitch
</span></span><span style="display:flex;"><span># l3_agent.ini 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/dhcp_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>interface_driver = openvswitch
</span></span><span style="display:flex;"><span>dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq
</span></span><span style="display:flex;"><span>enable_isolated_metadata = true
</span></span><span style="display:flex;"><span># dhcp_agent.ini 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/metadata_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>nova_metadata_host = controller
</span></span><span style="display:flex;"><span>metadata_proxy_shared_secret = metadata_secret
</span></span><span style="display:flex;"><span># metadata_agent.ini 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types =
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span># ml2_conf.ini 파일에 설정을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/openvswitch_agent.ini
</span></span><span style="display:flex;"><span>[securitygroup]
</span></span><span style="display:flex;"><span>firewall_driver = openvswitch
</span></span><span style="display:flex;"><span>enable_security_group = true
</span></span><span style="display:flex;"><span>enable_ipset = true
</span></span><span style="display:flex;"><span># openvswitch_agent.ini 파일의 하단에 추가합니다.
</span></span></code></pre></div><h1 id="heading-47">
  
  <a class="anchor" href="#heading-47">#</a>
</h1>
<ul>
<li><strong>Selinux 및 방화벽 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ setsebool -P neutron_can_network on
</span></span><span style="display:flex;"><span>$ setsebool -P haproxy_connect_any on
</span></span><span style="display:flex;"><span>$ setsebool -P daemons_enable_cluster_mode on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi my-ovsofctl.te
</span></span><span style="display:flex;"><span># create new
</span></span><span style="display:flex;"><span>module my-ovsofctl 1.0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span> <span style="color:#a6e22e">neutron_t</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">capability</span> <span style="color:#a6e22e">sys_rawio</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#============= neutron_t ==============
</span></span><span style="display:flex;"><span>allow neutron_t self:capability sys_rawio;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ checkmodule -m -M -o my-ovsofctl.mod my-ovsofctl.te 
</span></span><span style="display:flex;"><span>$ semodule_package --outfile my-ovsofctl.pp --module my-ovsofctl.mod 
</span></span><span style="display:flex;"><span>$ semodule -i my-ovsofctl.pp 
</span></span><span style="display:flex;"><span># Selinux 및 방화벽을 추가설정합니다.
</span></span></code></pre></div><h1 id="heading-48">
  
  <a class="anchor" href="#heading-48">#</a>
</h1>
<ul>
<li><strong>시스템을 재시작 합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</span></span><span style="display:flex;"><span>$ systemctl start openvswitch
</span></span><span style="display:flex;"><span>$ systemctl enable openvswitch
</span></span><span style="display:flex;"><span>$ ovs-vsctl add-br br-int
</span></span><span style="display:flex;"><span>$ systemctl restart openstack-nova-compute
</span></span><span style="display:flex;"><span>$ systemctl start neutron-openvswitch-agent
</span></span><span style="display:flex;"><span>$ systemctl enable neutron-openvswitch-agent
</span></span></code></pre></div><h1 id="heading-49">
  
  <a class="anchor" href="#heading-49">#</a>
</h1>
<ul>
<li><strong>이어서 compute 노드에서의 설정을 진행하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch
</span></span><span style="display:flex;"><span># neutron 패키지를 설치합니다.
</span></span></code></pre></div><h1 id="heading-50">
  
  <a class="anchor" href="#heading-50">#</a>
</h1>
<ul>
<li><strong>neutron 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>core_plugin = ml2
</span></span><span style="display:flex;"><span>service_plugins = router
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>stae_path = /var/lib/neutron
</span></span><span style="display:flex;"><span>allow_overlapping_ips = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types =
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span># ml2_conf.ini 파일에 설정을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/openvswitch_agent.ini
</span></span><span style="display:flex;"><span>[securitygroup]
</span></span><span style="display:flex;"><span>firewall_driver = openvswitch
</span></span><span style="display:flex;"><span>enable_security_group = true
</span></span><span style="display:flex;"><span>enable_ipset = true
</span></span><span style="display:flex;"><span># openvswitch_agent.ini 파일의 하단에 추가합니다.
</span></span></code></pre></div><h1 id="heading-51">
  
  <a class="anchor" href="#heading-51">#</a>
</h1>
<ul>
<li><strong>이어서 Nova.conf 파일을 수정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>use_neutron = True
</span></span><span style="display:flex;"><span>linuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver
</span></span><span style="display:flex;"><span>firewall_driver = nova.virt.firewall.NoopFirewallDriver
</span></span><span style="display:flex;"><span>vif_plugging_is_fatal = True
</span></span><span style="display:flex;"><span>vif_plugging_timeout = 300
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[neutron]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>region_name = RegionOne
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>service_metadata_proxy = True
</span></span><span style="display:flex;"><span>metadata_proxy_shared_secret = metadata_secret
</span></span></code></pre></div><h1 id="heading-52">
  
  <a class="anchor" href="#heading-52">#</a>
</h1>
<ul>
<li><strong>Selinux 및 방화벽 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ setsebool -P neutron_can_network on
</span></span><span style="display:flex;"><span>$ setsebool -P haproxy_connect_any on
</span></span><span style="display:flex;"><span>$ setsebool -P daemons_enable_cluster_mode on
</span></span><span style="display:flex;"><span>$ vi my-ovsofctl.te
</span></span><span style="display:flex;"><span># create new
</span></span><span style="display:flex;"><span>module my-ovsofctl 1.0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span> <span style="color:#a6e22e">neutron_t</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">capability</span> <span style="color:#a6e22e">sys_rawio</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#============= neutron_t ==============
</span></span><span style="display:flex;"><span>allow neutron_t self:capability sys_rawio;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ checkmodule -m -M -o my-ovsofctl.mod my-ovsofctl.te 
</span></span><span style="display:flex;"><span>$ semodule_package --outfile my-ovsofctl.pp --module my-ovsofctl.mod 
</span></span><span style="display:flex;"><span>$ semodule -i my-ovsofctl.pp 
</span></span><span style="display:flex;"><span># Selinux 및 방화벽을 추가설정합니다.
</span></span></code></pre></div><h1 id="heading-53">
  
  <a class="anchor" href="#heading-53">#</a>
</h1>
<ul>
<li><strong>시스템을 재시작 합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</span></span><span style="display:flex;"><span>$ systemctl start openvswitch
</span></span><span style="display:flex;"><span>$ systemctl enable openvswitch
</span></span><span style="display:flex;"><span>$ ovs-vsctl add-br br-int
</span></span><span style="display:flex;"><span>$ for service in dhcp-agent l3-agent metadata-agent openvswitch-agent; do
</span></span><span style="display:flex;"><span>systemctl start neutron-$service
</span></span><span style="display:flex;"><span>systemctl enable neutron-$service
</span></span><span style="display:flex;"><span>done
</span></span></code></pre></div><h1 id="heading-54">
  
  <a class="anchor" href="#heading-54">#</a>
</h1>
<p> </p>
<h1 id="heading-55">
  
  <a class="anchor" href="#heading-55">#</a>
</h1>
<ul>
<li><strong>이제 이어 compute 노드에서 neutron 서비스를 설치하도록 하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch
</span></span><span style="display:flex;"><span># neutron 서비스를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>core_plugin = ml2
</span></span><span style="display:flex;"><span>service_plugins = router
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>stae_path = /var/lib/neutron
</span></span><span style="display:flex;"><span>allow_overlapping_ips = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types =
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/openvswitch_agent.ini
</span></span><span style="display:flex;"><span>[securitygroup]
</span></span><span style="display:flex;"><span>firewall_driver = openvswitch
</span></span><span style="display:flex;"><span>enable_security_group = true
</span></span><span style="display:flex;"><span>enable_ipset = true
</span></span></code></pre></div><h1 id="heading-56">
  
  <a class="anchor" href="#heading-56">#</a>
</h1>
<ul>
<li><strong>이어서 nova.conf 파일을 수정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>use_neutron = True
</span></span><span style="display:flex;"><span>linuxnet_interface_driver = nova.network.linux_net.LinuxOVSInterfaceDriver
</span></span><span style="display:flex;"><span>firewall_driver = nova.virt.firewall.NoopFirewallDriver
</span></span><span style="display:flex;"><span>vif_plugging_is_fatal = True
</span></span><span style="display:flex;"><span>vif_plugging_timeout = 300
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[neutron]
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>region_name = RegionOne
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = neutron
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>service_metadata_proxy = True
</span></span><span style="display:flex;"><span>metadata_proxy_shared_secret = metadata_secret
</span></span></code></pre></div><h1 id="heading-57">
  
  <a class="anchor" href="#heading-57">#</a>
</h1>
<ul>
<li><strong>Selinux 및 방화벽 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein -y install openstack-selinux
</span></span><span style="display:flex;"><span>$ setsebool -P neutron_can_network on
</span></span><span style="display:flex;"><span>$ setsebool -P haproxy_connect_any on
</span></span><span style="display:flex;"><span>$ setsebool -P daemons_enable_cluster_mode on
</span></span><span style="display:flex;"><span>$ vi my-ovsofctl.te
</span></span><span style="display:flex;"><span># create new
</span></span><span style="display:flex;"><span>module my-ovsofctl 1.0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>require <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span> <span style="color:#a6e22e">neutron_t</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">capability</span> <span style="color:#a6e22e">sys_rawio</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#============= neutron_t ==============
</span></span><span style="display:flex;"><span>allow neutron_t self:capability sys_rawio;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ checkmodule -m -M -o my-ovsofctl.mod my-ovsofctl.te 
</span></span><span style="display:flex;"><span>$ semodule_package --outfile my-ovsofctl.pp --module my-ovsofctl.mod 
</span></span><span style="display:flex;"><span>$ semodule -i my-ovsofctl.pp 
</span></span><span style="display:flex;"><span># Selinux 및 방화벽을 추가설정합니다.
</span></span></code></pre></div><h1 id="heading-58">
  
  <a class="anchor" href="#heading-58">#</a>
</h1>
<ul>
<li><strong>서비스를 재시작 및 등록합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
</span></span><span style="display:flex;"><span>$ systemctl start openvswitch
</span></span><span style="display:flex;"><span>$ systemctl enable openvswitch
</span></span><span style="display:flex;"><span>$ ovs-vsctl add-br br-int
</span></span><span style="display:flex;"><span>$ systemctl restart openstack-nova-compute
</span></span><span style="display:flex;"><span>$ systemctl start neutron-openvswitch-agent
</span></span><span style="display:flex;"><span>$ systemctl enable neutron-openvswitch-agent
</span></span></code></pre></div><h1 id="heading-59">
  
  <a class="anchor" href="#heading-59">#</a>
</h1>
<p> </p>
<h1 id="heading-60">
  
  <a class="anchor" href="#heading-60">#</a>
</h1>
<ul>
<li><strong>이제 다음으로는 본격적으로 neutron 네트워크를 구현해보도록 하겠습니다.</strong></li>
<li><strong>먼저 controller 노드에서 ml2_conf 파일을 수정 및 추가합니다.</strong></li>
<li><strong>위에서 tenant 타입을 비워둔 이유는, 타입에 따라 사용하는 네트워크 구조가 달라지기 때문입니다.</strong></li>
<li><strong>여기서는 vxlan을 사용해 구성해보도록 하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>tenant_network_types = vxlan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_flat]
</span></span><span style="display:flex;"><span>flat_networks = physnet1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_vxlan]
</span></span><span style="display:flex;"><span>vni_ranges = 1:1000
</span></span><span style="display:flex;"><span># ml2.conf 파일을 수정합니다
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart neutron-server
</span></span><span style="display:flex;"><span># neutron 서비스를 재시작 합니다.
</span></span></code></pre></div><h1 id="heading-61">
  
  <a class="anchor" href="#heading-61">#</a>
</h1>
<ul>
<li><strong>이제 Network 노드에서의 설치를 진행해보도록 하겠습니다.</strong></li>
</ul>
<h1 id="heading-62">
  
  <a class="anchor" href="#heading-62">#</a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ ovs-vsctl add-br br-eth1
</span></span><span style="display:flex;"><span>$ ovs-vsctl add-port br-eth1 ens33
</span></span><span style="display:flex;"><span># 네트워크 브릿지를 생성하고, 네트워크 노드의 외부대역의 인터페이스 번호를 바인딩합니다.
</span></span></code></pre></div><h1 id="heading-63">
  
  <a class="anchor" href="#heading-63">#</a>
</h1>
<ul>
<li><strong>neutron 서비스 사용을 위한 설정을 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types = vxlan
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_flat]
</span></span><span style="display:flex;"><span>flat_networks = physnet1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_vxlan]
</span></span><span style="display:flex;"><span>vni_ranges = 1:1000
</span></span><span style="display:flex;"><span># ml2_conf.ini 파일에 설정을 추가 설정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/openvswitch_agent.ini
</span></span><span style="display:flex;"><span>[agent]
</span></span><span style="display:flex;"><span>tunnel_type = vxlan
</span></span><span style="display:flex;"><span>prevent_arp_spoofing = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ovs]
</span></span><span style="display:flex;"><span>local_ip = 10.10.10.20
</span></span><span style="display:flex;"><span>bridge_mappings = physnet1:br-eth1
</span></span><span style="display:flex;"><span># openvswitch_agent.ini 파일의 하단에 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ for service in dhcp-agent l3-agent metadata-agent openvswitch-agent; do systemctl restart neutron-$service
</span></span><span style="display:flex;"><span>done
</span></span><span style="display:flex;"><span># neutron 서비스를 재시작합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl stop firewalld
</span></span><span style="display:flex;"><span>$ systemctl disable firewalld
</span></span><span style="display:flex;"><span># 방화벽을 해제합니다.
</span></span></code></pre></div><h1 id="heading-64">
  
  <a class="anchor" href="#heading-64">#</a>
</h1>
<ul>
<li><strong>바인딩 오류를 해결하기 위해 설정을 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/sysconfig/network-scripts/ifcfg-ens33
</span></span><span style="display:flex;"><span>TYPE=Ethernet
</span></span><span style="display:flex;"><span>BOOTPROTO=static
</span></span><span style="display:flex;"><span>DEFROUTE=yes
</span></span><span style="display:flex;"><span>NAME=ens33
</span></span><span style="display:flex;"><span>DEVICE=ens33
</span></span><span style="display:flex;"><span>ONBOOT=yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /var/tmp/create_interface.sh
</span></span><span style="display:flex;"><span>#!/bin/bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip link set up br-eth1
</span></span><span style="display:flex;"><span>ip addr add 192.168.10.101/24 dev br-eth1
</span></span><span style="display:flex;"><span>route add default gw 192.168.10.2 dev br-eth1
</span></span><span style="display:flex;"><span>echo &#34;nameserver 8.8.8.8&#34; &gt; /etc/resolv.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod 755 /var/tmp/create_interface.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/systemd/system/set_interface.service
</span></span><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=Description for sample script goes here
</span></span><span style="display:flex;"><span>After=network.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>Type=simple
</span></span><span style="display:flex;"><span>ExecStart=/var/tmp/create_interface.sh
</span></span><span style="display:flex;"><span>TimeoutStartSec=0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=default.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl enable set_interface
</span></span><span style="display:flex;"><span>$ init 6
</span></span></code></pre></div><h1 id="heading-65">
  
  <a class="anchor" href="#heading-65">#</a>
</h1>
<ul>
<li><strong>이어 compute 노드에서의 설정을 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/ml2_conf.ini
</span></span><span style="display:flex;"><span>[ml2]
</span></span><span style="display:flex;"><span>type_drivers = flat,vlan,gre,vxlan
</span></span><span style="display:flex;"><span>tenant_network_types = vxlan
</span></span><span style="display:flex;"><span>mechanism_drivers = openvswitch
</span></span><span style="display:flex;"><span>extension_drivers = port_security
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_flat]
</span></span><span style="display:flex;"><span>flat_networks = physnet1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ml2_type_vxlan]
</span></span><span style="display:flex;"><span>vni_ranges = 1:1000
</span></span><span style="display:flex;"><span># ml2_conf.ini 파일에 설정을 추가 설정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/plugins/ml2/openvswitch_agent.ini
</span></span><span style="display:flex;"><span>[agent]
</span></span><span style="display:flex;"><span>tunnel_type = vxlan
</span></span><span style="display:flex;"><span>prevent_arp_spoofing = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ovs]
</span></span><span style="display:flex;"><span>local_ip = 10.10.10.30
</span></span><span style="display:flex;"><span># openvswitch_agent.ini 파일의 하단에 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ for service in dhcp-agent l3-agent metadata-agent openvswitch-agent; do systemctl restart neutron-$service
</span></span><span style="display:flex;"><span>done
</span></span><span style="display:flex;"><span># neutron 서비스를 재시작합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl stop firewalld
</span></span><span style="display:flex;"><span>$ systemctl disable firewalld
</span></span><span style="display:flex;"><span># 방화벽을 해제합니다.
</span></span></code></pre></div><h1 id="heading-66">
  
  <a class="anchor" href="#heading-66">#</a>
</h1>
<ul>
<li><strong>확인</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ openstack network agent list
</span></span><span style="display:flex;"><span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span></span><span style="display:flex;"><span>| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span></span><span style="display:flex;"><span>| 261bbd8f-ece9-4818-91c3-be75b928fa54 | Open vSwitch agent | network    | None              | :-)   | UP    | neutron-openvswitch-agent |
</span></span><span style="display:flex;"><span>| 26376b7b-e4d0-413c-85b9-521994c41bf6 | Open vSwitch agent | compute    | None              | :-)   | UP    | neutron-openvswitch-agent |
</span></span><span style="display:flex;"><span>| 8b520189-c500-47ec-b330-b84bc0a3b622 | Metadata agent     | controller | None              | :-)   | UP    | neutron-metadata-agent    |
</span></span><span style="display:flex;"><span>| ba443e32-a931-465f-acff-05621dac0424 | Metadata agent     | network    | None              | :-)   | UP    | neutron-metadata-agent    |
</span></span><span style="display:flex;"><span>| be878ec2-b8c9-4923-8d01-111d7c11c8f1 | L3 agent           | network    | nova              | :-)   | UP    | neutron-l3-agent          |
</span></span><span style="display:flex;"><span>| cb74c09d-7ec5-4457-a384-8303235adc97 | DHCP agent         | network    | nova              | :-)   | UP    | neutron-dhcp-agent        |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack router create router01
</span></span><span style="display:flex;"><span>$ openstack network create int --provider-network-type vxlan
</span></span><span style="display:flex;"><span>$ openstack subnet create int_sub --network int \
</span></span><span style="display:flex;"><span>--subnet-range 1.1.1.0/24 --gateway 1.1.1.2 \
</span></span><span style="display:flex;"><span>--dns-nameserver 8.8.8.8
</span></span><span style="display:flex;"><span># 라우터와 내부대역을 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack router add subnet router01 int_sub
</span></span><span style="display:flex;"><span># 라우터와 내부대벽을 연결시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack network create \
</span></span><span style="display:flex;"><span>--provider-physical-network physnet1 \
</span></span><span style="display:flex;"><span>--provider-network-type flat --external ext
</span></span><span style="display:flex;"><span>$ openstack subnet create subnet2 \
</span></span><span style="display:flex;"><span>--network ext_net --subnet-range 192.168.10.0/24 \
</span></span><span style="display:flex;"><span>--allocation-pool start=192.168.10.150,end=192.168.10.200 \
</span></span><span style="display:flex;"><span>--gateway 192.168.10.2 --dns-nameserver 8.8.8.8
</span></span><span style="display:flex;"><span># 외부대역을 생성합니다. 외부대역의 IP는 바인딩한 br-eth1의 IP 대역과 동일해야합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack router set router01 --external-gateway ext
</span></span><span style="display:flex;"><span># 생성한 라우터의 게이트웨이를 생성한 외부대역에 바운딩시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack network list
</span></span><span style="display:flex;"><span>+--------------------------------------+------+--------------------------------------+
</span></span><span style="display:flex;"><span>| ID                                   | Name | Subnets                              |
</span></span><span style="display:flex;"><span>+--------------------------------------+------+--------------------------------------+
</span></span><span style="display:flex;"><span>| 2875f833-2d46-4740-bdd4-09c75c53e2b1 | int  | 698d35ae-8d7c-436f-be1b-fcf4319eb5fe |
</span></span><span style="display:flex;"><span>| 4a25933d-ed21-4a5c-a87b-4e782e93c14c | ext  | 47b0ee11-b628-4260-9185-71d1dab401ea |
</span></span><span style="display:flex;"><span>+--------------------------------------+------+--------------------------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack subnet list
</span></span><span style="display:flex;"><span>+--------------------------------------+---------+--------------------------------------+-----------------+
</span></span><span style="display:flex;"><span>| ID                                   | Name    | Network                              | Subnet          |
</span></span><span style="display:flex;"><span>+--------------------------------------+---------+--------------------------------------+-----------------+
</span></span><span style="display:flex;"><span>| 47b0ee11-b628-4260-9185-71d1dab401ea | ext-sub | 4a25933d-ed21-4a5c-a87b-4e782e93c14c | 192.168.10.0/24 |
</span></span><span style="display:flex;"><span>| 698d35ae-8d7c-436f-be1b-fcf4319eb5fe | int-sub | 2875f833-2d46-4740-bdd4-09c75c53e2b1 | 1.1.1.0/24      |
</span></span><span style="display:flex;"><span>+--------------------------------------+---------+--------------------------------------+-----------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ wget http://cloud-images.ubuntu.com/releases/18.04/release/ubuntu-18.04-server-cloudimg-amd64.img -P /var/kvm/images
</span></span><span style="display:flex;"><span>$ openstack image create &#34;Ubuntu1804&#34; --file /var/kvm/images/ubuntu-18.04-server-cloudimg-amd64.img --disk-format qcow2 --container-format bare --public
</span></span><span style="display:flex;"><span># 이미지를 다운로드 및 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack flavor create --ram 1024 --disk 10 --vcpus 1 m1.small
</span></span><span style="display:flex;"><span># flavor를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ssh-keygen -q -N &#34;&#34;
</span></span><span style="display:flex;"><span>$ openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey
</span></span><span style="display:flex;"><span># keypair를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack floating ip create ext
</span></span><span style="display:flex;"><span># floating ip를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack create server --image Ubuntu1804 --flavor m1.small --key mykey --network int Ubuntu
</span></span><span style="display:flex;"><span>$ openstack server add floating ip Ubuntu 192.168.10.170
</span></span><span style="display:flex;"><span># 인스턴스를 생성하고 floating ip를 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack server list
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+-------------------------------+------------+----------+
</span></span><span style="display:flex;"><span>| ID                                   | Name   | Status | Networks                      | Image      | Flavor   |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+-------------------------------+------------+----------+
</span></span><span style="display:flex;"><span>| 75fa0186-ab63-4aaa-a27c-3f2126e5d31d | Ubuntu | ACTIVE | int=1.1.1.248, 192.168.10.170 | Ubuntu1804 | m1.small |
</span></span><span style="display:flex;"><span>+--------------------------------------+--------+--------+-------------------------------+------------+----------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack security group create open
</span></span><span style="display:flex;"><span>$ openstack security group rule create --protocol icmp --ingress open
</span></span><span style="display:flex;"><span>$ openstack security group rule create --protocol tcp --dst-port 22:22 open
</span></span><span style="display:flex;"><span>$ openstack security group rule create --protocol tcp --dst-port 80:80 open
</span></span><span style="display:flex;"><span>$ openstack server add security group Ubuntu open
</span></span><span style="display:flex;"><span># 보안그룹을 생성하고 적용시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ssh ubuntu@192.168.10.170
</span></span><span style="display:flex;"><span>$ ping 8.8.8.8
</span></span><span style="display:flex;"><span>$ sudo apt -y install apache2
</span></span><span style="display:flex;"><span>$ sudo service apache2 start
</span></span><span style="display:flex;"><span># 본체 Host에서 접속해서 확인
</span></span></code></pre></div><ul>
<li><strong>이것으로 기본적인 openstack-stein 버전의 설치를 완료하였습니다.</strong></li>
</ul>
<h1 id="heading-67">
  
  <a class="anchor" href="#heading-67">#</a>
</h1>
<p> </p>
<h1 id="heading-68">
  
  <a class="anchor" href="#heading-68">#</a>
</h1>
<h3 id="7-horizon--대시보드-서비스--구성">
  <strong>7. Horizon ( 대시보드 서비스 ) 구성</strong>
  <a class="anchor" href="#7-horizon--%eb%8c%80%ec%8b%9c%eb%b3%b4%eb%93%9c-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Horizon은 controller 노드에서 설치가 진행됩니다.</strong></li>
<li><strong>에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/horizon/">Horizone</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-69">
  
  <a class="anchor" href="#heading-69">#</a>
</h1>
<ul>
<li><strong>Horizon 패키지 설치</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$  yum --enablerepo=centos-openstack-stein,epel -y install openstack-dashboard
</span></span><span style="display:flex;"><span># Horizon 패키지를 설치합니다.
</span></span></code></pre></div><h1 id="heading-70">
  
  <a class="anchor" href="#heading-70">#</a>
</h1>
<ul>
<li><strong>대시보드를 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/openstack-dashboard/local_settings
</span></span><span style="display:flex;"><span>ALLOWED_HOSTS = [&#39;*&#39;] 
</span></span><span style="display:flex;"><span># 수정
</span></span><span style="display:flex;"><span>OPENSTACK_API_VERSIONS = <span style="color:#75715e">{</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;identity&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;image&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;volume&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;compute&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span># 주석 제거 및 수정
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True 
</span></span><span style="display:flex;"><span># 주석 해제 및 수정
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &#39;Default&#39; 
</span></span><span style="display:flex;"><span># 주석 제거
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CACHES = <span style="color:#75715e">{</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;default&#39;</span><span style="color:#f92672">:</span> <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;BACKEND&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;LOCATION&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;127.0.0.1:11211&#39;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">}</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span># 주석제거
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OPENSTACK_HOST = &#34;controller&#34;
</span></span><span style="display:flex;"><span># IP 변경
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OPENSTACK_KEYSTONE_DEFAULT_ROLE = &#34;member&#34;
</span></span><span style="display:flex;"><span># 수정
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/httpd/conf.d/openstack-dashboard.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WSGIDaemonProcess dashboard
</span></span><span style="display:flex;"><span>WSGIProcessGroup dashboard
</span></span><span style="display:flex;"><span>WSGISocketPrefix run/wsgi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>WSGIApplicationGroup %<span style="color:#75715e">{</span><span style="color:#a6e22e">GLOBAL</span><span style="color:#75715e">}</span>
</span></span><span style="display:flex;"><span># 추가
</span></span></code></pre></div><h1 id="heading-71">
  
  <a class="anchor" href="#heading-71">#</a>
</h1>
<ul>
<li><strong>Selinux 및 방화벽 설정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ setsebool -P httpd_can_network_connect on
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-service=<span style="color:#75715e">{</span><span style="color:#a6e22e">http</span><span style="color:#f92672">,</span><span style="color:#a6e22e">https</span><span style="color:#75715e">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart httpd
</span></span></code></pre></div><h1 id="heading-72">
  
  <a class="anchor" href="#heading-72">#</a>
</h1>
<ul>
<li>** DB 생성**</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database keystone;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on .* to @&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on .* to @&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span>#  구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-73">
  
  <a class="anchor" href="#heading-73">#</a>
</h1>
<p> </p>
<h1 id="heading-74">
  
  <a class="anchor" href="#heading-74">#</a>
</h1>
<h3 id="8-cinder--오브젝트-스토리지-및-블록-스토리지-구성-">
  <strong>8. Cinder ( 오브젝트 스토리지 및 블록 스토리지 구성 )</strong>
  <a class="anchor" href="#8-cinder--%ec%98%a4%eb%b8%8c%ec%a0%9d%ed%8a%b8-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%eb%b0%8f-%eb%b8%94%eb%a1%9d-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%ea%b5%ac%ec%84%b1-">#</a>
</h3>
<hr>
<ul>
<li><strong>Cinder는 기본적으로 독립적으로 storage 노드를 구성하거나 혹은 compute 노드에 추가하여 사용합니다.</strong></li>
<li><strong>여기서는 compute 노드에 포함하여 구성하도록 하겠습니다/</strong></li>
<li><strong>구성 순서는 controller &gt; compute 노드 순으로 진행하겠습니다.</strong></li>
<li><strong>Cinder에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/cinder/">Cinder</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-75">
  
  <a class="anchor" href="#heading-75">#</a>
</h1>
<ul>
<li><strong>Cinder 서비스 등록</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ source ~/admin
</span></span><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 cinder
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user cinder admin
</span></span><span style="display:flex;"><span>$ openstack service create --name cinderv3 --description &#34;OpenStack Block service&#34; volumev3
</span></span><span style="display:flex;"><span># cinder 사용자를 추가 및 서비스를 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export controller=10.10.10.10
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne volumev3 public http://$controller:8776/v3/%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne volumev3 internal http://$controller:8776/v3/%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne volumev3 admin http://$controller:8776/v3/%\(tenant_id\)s
</span></span><span style="display:flex;"><span># cinder의 endpoint를 생성합니다.
</span></span></code></pre></div><h1 id="heading-76">
  
  <a class="anchor" href="#heading-76">#</a>
</h1>
<ul>
<li><strong>Cinder DB 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database cinder;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on cinder.* to cinder@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on cinder.* to cinder@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span># cinder 구성을 위한 db를 생성합니다. ( 저는 편의를 위해 모든 pw로 qwer1234 설정하였습니다. )
</span></span></code></pre></div><h1 id="heading-77">
  
  <a class="anchor" href="#heading-77">#</a>
</h1>
<ul>
<li><strong>cinder 패키지 설치 및 수정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$  yum --enablerepo=centos-openstack-stein,epel -y install openstack-cinder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/cinder/cinder.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>my_ip = 10.10.10.10
</span></span><span style="display:flex;"><span>log_dir = /var/log/cinder
</span></span><span style="display:flex;"><span>state_path = /var/lib/cinder
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>enable_v3_api = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = cinder
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://cinder:qwer1234@controller/cinder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span># cinder.conf 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/bash cinder -c &#34;cinder-manage db sync&#34;
</span></span><span style="display:flex;"><span># cinder db를 동기화시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start openstack-cinder-api openstack-cinder-scheduler
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-cinder-api openstack-cinder-scheduler
</span></span><span style="display:flex;"><span># cinder 시작 및 자동시작을 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo &#34;export OS_VOLUME_API_VERSION=3&#34; &gt;&gt; ~/admin
</span></span><span style="display:flex;"><span>$ source ~/admin
</span></span><span style="display:flex;"><span># 볼륨 버전을 API 3로 지정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=8776/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-78">
  
  <a class="anchor" href="#heading-78">#</a>
</h1>
<p> </p>
<h1 id="heading-79">
  
  <a class="anchor" href="#heading-79">#</a>
</h1>
<ul>
<li><strong>이어서 compute 노드에 설치를 진행하겠습니다.</strong></li>
<li><strong>cinder 패키지 설치 및 수정</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$  yum --enablerepo=centos-openstack-stein,epel -y install openstack-cinder python2-crypto targetcli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/cinder/cinder.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>my_ip = 10.10.10.30
</span></span><span style="display:flex;"><span>log_dir = /var/log/cinder
</span></span><span style="display:flex;"><span>state_path = /var/lib/cinder
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>glance_api_servers = http://controller:9292
</span></span><span style="display:flex;"><span>enable_v3_api = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = cinder
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://cinder:qwer1234@controller/cinder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[oslo_concurrency]
</span></span><span style="display:flex;"><span>lock_path = $state_path/tmp
</span></span><span style="display:flex;"><span># cinder.conf 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start openstack-cinder-volume
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-cinder-volume
</span></span><span style="display:flex;"><span># cinder 서비스를 시작 및 자동시작을 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ controller $openstack volume service list
</span></span><span style="display:flex;"><span># 확인
</span></span><span style="display:flex;"><span>+------------------+------------+------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>| Binary           | Host       | Zone | Status  | State | Updated At                 |
</span></span><span style="display:flex;"><span>+------------------+------------+------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>| cinder-scheduler | controller | nova | enabled | up    | 2020-07-20T04:02:31.000000 |
</span></span><span style="display:flex;"><span>+------------------+------------+------+---------+-------+----------------------------+
</span></span></code></pre></div><h1 id="heading-80">
  
  <a class="anchor" href="#heading-80">#</a>
</h1>
<p> </p>
<h1 id="heading-81">
  
  <a class="anchor" href="#heading-81">#</a>
</h1>
<h3 id="8-2-lvm으로-블록-스토리지-백엔드-구성">
  <strong>8-2. LVM으로 블록 스토리지 백엔드 구성</strong>
  <a class="anchor" href="#8-2-lvm%ec%9c%bc%eb%a1%9c-%eb%b8%94%eb%a1%9d-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%eb%b0%b1%ec%97%94%eb%93%9c-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<h1 id="heading-82">
  
  <a class="anchor" href="#heading-82">#</a>
</h1>
<ul>
<li><strong>compute 노드에 cinder 서비스를 설치한 것에 이어 LVM 백엔드를 설정해보도록 하겠습니다.</strong></li>
<li><strong><a href="">VG 생성 참조</a></strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ fdisk /dev/sd[ n ]
</span></span><span style="display:flex;"><span># 만약 디스크 파티션이 없으시면 새로 생성 후 등록합니다.
</span></span><span style="display:flex;"><span># 저는 간단하게 100G 하드를 추가한 후, cinder 이름으로 vg를 생성하였습니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/cinder/cinder.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>enabled_backends = lvm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[lvm]
</span></span><span style="display:flex;"><span>target_helper = lioadm
</span></span><span style="display:flex;"><span>target_protocol = iscsi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target_ip_address = 10.10.10.30
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>volume_group = cinder
</span></span><span style="display:flex;"><span>volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver
</span></span><span style="display:flex;"><span>volume_dir = $state_path/volumes
</span></span><span style="display:flex;"><span># cinder.conf의 상단에 내용을 추가설정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-service=iscsi-target --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># 방화벽 설정을 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart openstack-cinder-volume
</span></span><span style="display:flex;"><span># 서비스를 재시작합니다.
</span></span></code></pre></div><h1 id="heading-83">
  
  <a class="anchor" href="#heading-83">#</a>
</h1>
<ul>
<li><strong>이어서 compute 노드의 nova.conf 파일을 수정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ vi /etc/nova/nova.conf
</span></span><span style="display:flex;"><span>[cinder]
</span></span><span style="display:flex;"><span>os_region_name = RegionOne
</span></span><span style="display:flex;"><span># nova.conf의 하단에 상단의 내용을 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart openstack-nova-compute
</span></span><span style="display:flex;"><span># nova 서비스를 재시작합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ controller $ openstack volume service list
</span></span><span style="display:flex;"><span># 생성을 확인합니다.
</span></span><span style="display:flex;"><span>+------------------+-------------+------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>| Binary           | Host        | Zone | Status  | State | Updated At                 |
</span></span><span style="display:flex;"><span>+------------------+-------------+------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>| cinder-scheduler | controller  | nova | enabled | up    | 2020-07-20T04:54:52.000000 |
</span></span><span style="display:flex;"><span>| cinder-volume    | compute@lvm | nova | enabled | up    | 2020-07-20T04:54:52.000000 |
</span></span><span style="display:flex;"><span>+------------------+-------------+------+---------+-------+----------------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ controller $ openstack volume cretae --size 1 test
</span></span><span style="display:flex;"><span># 확인용 1G volume을 생성합니다.
</span></span><span style="display:flex;"><span>+---------------------+--------------------------------------+
</span></span><span style="display:flex;"><span>| Field               | Value                                |
</span></span><span style="display:flex;"><span>+---------------------+--------------------------------------+
</span></span><span style="display:flex;"><span>| attachments         | []                                   |
</span></span><span style="display:flex;"><span>| availability_zone   | nova                                 |
</span></span><span style="display:flex;"><span>| bootable            | false                                |
</span></span><span style="display:flex;"><span>| consistencygroup_id | None                                 |
</span></span><span style="display:flex;"><span>| created_at          | 2020-07-20T05:00:21.000000           |
</span></span><span style="display:flex;"><span>| description         | None                                 |
</span></span><span style="display:flex;"><span>| encrypted           | False                                |
</span></span><span style="display:flex;"><span>| id                  | f09ee80f-3ec8-4eaf-a4a5-af13cccbd5ae |
</span></span><span style="display:flex;"><span>| migration_status    | None                                 |
</span></span><span style="display:flex;"><span>| multiattach         | False                                |
</span></span><span style="display:flex;"><span>| name                | test                                 |
</span></span><span style="display:flex;"><span>| properties          |                                      |
</span></span><span style="display:flex;"><span>| replication_status  | None                                 |
</span></span><span style="display:flex;"><span>| size                | 1                                    |
</span></span><span style="display:flex;"><span>| snapshot_id         | None                                 |
</span></span><span style="display:flex;"><span>| source_volid        | None                                 |
</span></span><span style="display:flex;"><span>| status              | creating                             |
</span></span><span style="display:flex;"><span>| type                | None                                 |
</span></span><span style="display:flex;"><span>| updated_at          | None                                 |
</span></span><span style="display:flex;"><span>| user_id             | 296ce49d1dc94931b62a726fb64712e9     |
</span></span><span style="display:flex;"><span>+---------------------+--------------------------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack volume list
</span></span><span style="display:flex;"><span># 생성한 volume을 확인합니다.
</span></span><span style="display:flex;"><span>+--------------------------------------+------+-----------+------+-------------+
</span></span><span style="display:flex;"><span>| ID                                   | Name | Status    | Size | Attached to |
</span></span><span style="display:flex;"><span>+--------------------------------------+------+-----------+------+-------------+
</span></span><span style="display:flex;"><span>| f09ee80f-3ec8-4eaf-a4a5-af13cccbd5ae | test | available |    1 |             |
</span></span><span style="display:flex;"><span>+--------------------------------------+------+-----------+------+-------------+
</span></span></code></pre></div><h1 id="heading-84">
  
  <a class="anchor" href="#heading-84">#</a>
</h1>
<p> </p>
<h1 id="heading-85">
  
  <a class="anchor" href="#heading-85">#</a>
</h1>
<h3 id="8-3-lbaas-설치">
  <strong>8-3. LBaaS 설치</strong>
  <a class="anchor" href="#8-3-lbaas-%ec%84%a4%ec%b9%98">#</a>
</h3>
<ul>
<li><strong>로드밸런싱을 위해서는 LBaaS를 사용해야 합니다.</strong></li>
<li><strong>LBaaS에 대해서는 <a href="https://mung0001.github.io/docs/study/openstack/neutron/">LBaaS</a>를 참조해주세요.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron-lbaas net-tools
</span></span><span style="display:flex;"><span># LBaaS 서비스를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>service_plugins = router,lbaasv2
</span></span><span style="display:flex;"><span># lbaasv2 서비스를 추가합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron_lbaas.conf
</span></span><span style="display:flex;"><span>[service_providers]
</span></span><span style="display:flex;"><span>service_provider = LOADBALANCERV2:Haproxy:neutron_lbaas.drivers.haproxy.plugin_driver.HaproxyOnHostPluginDriver:default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/lbaas_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>interface_driver = openvswitch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/bash neutron -c &#34;neutron-db-manage --subproject neutron-lbaas --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugin.ini upgrade head&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl restart neutron-server
</span></span></code></pre></div><h1 id="heading-86">
  
  <a class="anchor" href="#heading-86">#</a>
</h1>
<ul>
<li><strong>network 노드와 compute 노드는 동일하게 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-neutron-lbaas haproxy net-tools
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron.conf
</span></span><span style="display:flex;"><span>service_plugins = router,lbaasv2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/neutron_lbaas.conf
</span></span><span style="display:flex;"><span>[service_providers]
</span></span><span style="display:flex;"><span>service_provider = LOADBALANCERV2:Haproxy:neutron_lbaas.drivers.haproxy.plugin_driver.HaproxyOnHostPluginDriver:default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/neutron/lbaas_agent.ini
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>interface_driver = openvswitch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start neutron-lbaasv2-agent
</span></span><span style="display:flex;"><span>$ systemctl enable neutron-lbaasv2-agent
</span></span></code></pre></div><h1 id="heading-87">
  
  <a class="anchor" href="#heading-87">#</a>
</h1>
<p> </p>
<h1 id="heading-88">
  
  <a class="anchor" href="#heading-88">#</a>
</h1>
<h3 id="8-4-lfs-lvm-기반-다중-스토리지-노드-구성">
  <strong>8-4. LFS, LVM 기반 다중 스토리지 노드 구성</strong>
  <a class="anchor" href="#8-4-lfs-lvm-%ea%b8%b0%eb%b0%98-%eb%8b%a4%ec%a4%91-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%eb%85%b8%eb%93%9c-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<h1 id="heading-89">
  
  <a class="anchor" href="#heading-89">#</a>
</h1>
<p> </p>
<h1 id="heading-90">
  
  <a class="anchor" href="#heading-90">#</a>
</h1>
<h3 id="9-swift--오브젝트-스토리지-서비스--구성">
  <strong>9. Swift ( 오브젝트 스토리지 서비스 ) 구성</strong>
  <a class="anchor" href="#9-swift--%ec%98%a4%eb%b8%8c%ec%a0%9d%ed%8a%b8-%ec%8a%a4%ed%86%a0%eb%a6%ac%ec%a7%80-%ec%84%9c%eb%b9%84%ec%8a%a4--%ea%b5%ac%ec%84%b1">#</a>
</h3>
<hr>
<ul>
<li><strong>Swift란 오브젝트 스토리지 서비스로, 흔히 우리가 생각하는 네이버 클라우드와 거의 동일한 맥락이라 할 수 있습니다.</strong></li>
<li><strong>swift는 기본적으로 controller에 설치하나 여기서는 비교적 자원소모가 적은 network 노드에 proxy-sever를, compute 노드를 storage로 사용하여 설치하여 진행하겠습니다.</strong></li>
<li><strong>swift</strong>에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/swift/">swift</a>을 참조해주세요.**</li>
</ul>
<h1 id="heading-91">
  
  <a class="anchor" href="#heading-91">#</a>
</h1>
<ul>
<li><strong>swift 서비스 생성</strong></li>
<li><strong>controlloer 노드에는 swift 관련 패키지를 설치하지는 않지만 서비스의 관리를 위해 유저, 엔드포인트, url을 생성합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 swift
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user swift admin
</span></span><span style="display:flex;"><span>$ openstack service create --name swift --description &#34;OpenStack Object Storage&#34; object-store
</span></span><span style="display:flex;"><span># swfit 유저를 생성하고 관리자의 권한을 부여합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export swift_proxy=10.10.10.20
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne object-store public http://$swift_proxy:8080/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne object-store internal http://$swift_proxy:8080/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne object-store admin http://$swift_proxy:8080/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span># swift의 endpoint를 등록합니다. 여기서 proxy 서버는 네트워크 노드를 등록합니다.
</span></span></code></pre></div><h1 id="heading-92">
  
  <a class="anchor" href="#heading-92">#</a>
</h1>
<p> </p>
<h1 id="heading-93">
  
  <a class="anchor" href="#heading-93">#</a>
</h1>
<ul>
<li><strong>이어서 network 노드에서의 swift 설치 및 설정을 진행하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-swift-proxy python-memcached openssh-clients
</span></span><span style="display:flex;"><span># swift 서비스에 필요한 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/proxy-server.conf
</span></span><span style="display:flex;"><span>[filter:cache]
</span></span><span style="display:flex;"><span>use = egg:swift#memcache
</span></span><span style="display:flex;"><span>#memcache_servers = 127.0.0.1:11211
</span></span><span style="display:flex;"><span>memcache_servers = controller:11211
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[filter:authtoken]
</span></span><span style="display:flex;"><span>paste.filter_factory = keystonemiddleware.auth_token:filter_factory
</span></span><span style="display:flex;"><span>#admin_tenant_name = %SERVICE_TENANT_NAME%
</span></span><span style="display:flex;"><span>#admin_user = %SERVICE_USER%
</span></span><span style="display:flex;"><span>#admin_password = %SERVICE_PASSWORD%
</span></span><span style="display:flex;"><span>#admin_host = 127.0.0.1
</span></span><span style="display:flex;"><span>#admin_port = 35357
</span></span><span style="display:flex;"><span>#admin_protocol = http
</span></span><span style="display:flex;"><span>#admin_ /tmp/keystone-signing-swift
</span></span><span style="display:flex;"><span># paste.filter_factory를 제외한 기존 정보는 주석처리
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = swift
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>delay_auth_decision = true
</span></span><span style="display:flex;"><span># 위에 내용을 대신 주석 추가
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># proxy-server.conf 파일을 수정합니다.
</span></span><span style="display:flex;"><span># memcache_servers의 IP는 controller 노드의 IP로 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/swift.conf
</span></span><span style="display:flex;"><span>[swift-hash]
</span></span><span style="display:flex;"><span>#swift_hash_path_suffix = %SWIFT_HASH_PATH_SUFFIX%
</span></span><span style="display:flex;"><span>swift_hash_path_suffix = swift_shared_path
</span></span><span style="display:flex;"><span>swift_hash_path_prefix = swift_shared_path
</span></span></code></pre></div><h1 id="heading-94">
  
  <a class="anchor" href="#heading-94">#</a>
</h1>
<ul>
<li><strong>swift 서비스의 사용을 위해 account, container, object를 생성합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/account.builder create 12 1 1
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/container.builder create 12 1 1
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/object.builder create 12 1 1
</span></span><span style="display:flex;"><span># account, container, object를 생성합니다.
</span></span><span style="display:flex;"><span># 12 = 한 클러스터 스토리지에서 생성 가능한 파티션의 수
</span></span><span style="display:flex;"><span># 1 = 오브젝트 복수 수 ( 스토리지의 개수 )
</span></span><span style="display:flex;"><span># 1 = 데이터 이동, 복제, 파티션 이동 등이 진행될 때 잠기는 최소 시간, 데이터 손실을 방지하기 위한 기능
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/account.builder add r0z0-10.10.10.30:6202/device0 100
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/container.builder add r0z0-10.10.10.30:6201/device0 100
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/object.builder add r0z0-10.10.10.30:6200/device0 100
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/account.builder rebalance
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/container.builder rebalance
</span></span><span style="display:flex;"><span>$ swift-ring-builder /etc/swift/object.builder rebalance
</span></span><span style="display:flex;"><span># compute 노드의 builder에 region과 zone을 추가 후 반영시킵니다.
</span></span><span style="display:flex;"><span># r = region, z = zone
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown swift. /etc/swift/*.gz
</span></span><span style="display:flex;"><span># swift 관련 파일의 소유권을 변경합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ systemctl start openstack-swift-proxy
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-swift-proxy
</span></span><span style="display:flex;"><span># 프록시 서비스를 시작합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=8080/tcp --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span># 방화벽을 사용 중이라면 방화벽을 등록합니다.
</span></span></code></pre></div><h1 id="heading-95">
  
  <a class="anchor" href="#heading-95">#</a>
</h1>
<p> </p>
<h1 id="heading-96">
  
  <a class="anchor" href="#heading-96">#</a>
</h1>
<ul>
<li><strong>이제 이어 storage를 구성하기 위해 compute 노드에서의 설치를 진행해보도록 하겠습니다.</strong></li>
<li><strong>compute 노드는 이미 cinder 서비스가 동작하고 있어 기본적인 네트워크, 시간 설정, 레포지터리 지정 등은 구성이 마친 상태의 노드입니다.</strong></li>
<li><strong>만약 다른 노드에 구성하시거나 swift 서비스를 다중 노드로 구성하시는  경우 위와 같은 설정을 먼저 진행해주시길 바랍니다.</strong></li>
<li><strong>여기서는 swift 서비스를 위해 100G의 버츄얼 디스크( dev/sdc )를 추가하여 진행하였습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-swift-account openstack-swift-container openstack-swift-object xfsprogs rsync openssh-clients
</span></span><span style="display:flex;"><span># swift 서비스를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ scp root@network:/etc/swift/*.gz /etc/swift/
</span></span><span style="display:flex;"><span>$ chown swift. /etc/swift/*.gz
</span></span><span style="display:flex;"><span># network 노드에서의 설정파일을 복사옵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/swift.conf
</span></span><span style="display:flex;"><span>[swift-hash]
</span></span><span style="display:flex;"><span>#swift_hash_path_suffix = %SWIFT_HASH_PATH_SUFFIX%
</span></span><span style="display:flex;"><span>swift_hash_path_suffix = swift_shared_path
</span></span><span style="display:flex;"><span>swift_hash_path_prefix = swift_shared_path
</span></span><span style="display:flex;"><span>$ swift.conf 파일을 설정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/account-server.conf
</span></span><span style="display:flex;"><span>bind-ip = 0.0.0.0
</span></span><span style="display:flex;"><span>bind_port = 6202
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/container-server.conf
</span></span><span style="display:flex;"><span>bind-ip = 0.0.0.0
</span></span><span style="display:flex;"><span>bind_port = 6201
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/swift/object-server.conf
</span></span><span style="display:flex;"><span>bind-ip = 0.0.0.0
</span></span><span style="display:flex;"><span>bind_port = 6200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/rsyncd.conf
</span></span><span style="display:flex;"><span>pid file = /var/run/rsymcd.pid
</span></span><span style="display:flex;"><span>log file = /var/log/rsymcd.log
</span></span><span style="display:flex;"><span>uid = swift
</span></span><span style="display:flex;"><span>gid = swift
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>address = compute
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[account]
</span></span><span style="display:flex;"><span>path            = /srv/node
</span></span><span style="display:flex;"><span>read only       = false
</span></span><span style="display:flex;"><span>write only      = no
</span></span><span style="display:flex;"><span>list            = yes
</span></span><span style="display:flex;"><span>incoming chmod  = 0644
</span></span><span style="display:flex;"><span>outgoing chmod  = 0644
</span></span><span style="display:flex;"><span>max connections = 25
</span></span><span style="display:flex;"><span>lock file =     /var/lock/account.lock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[container]
</span></span><span style="display:flex;"><span>path            = /srv/node
</span></span><span style="display:flex;"><span>read only       = false
</span></span><span style="display:flex;"><span>write only      = no
</span></span><span style="display:flex;"><span>list            = yes
</span></span><span style="display:flex;"><span>incoming chmod  = 0644
</span></span><span style="display:flex;"><span>outgoing chmod  = 0644
</span></span><span style="display:flex;"><span>max connections = 25
</span></span><span style="display:flex;"><span>lock file =     /var/lock/container.lock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[object]
</span></span><span style="display:flex;"><span>path            = /srv/node
</span></span><span style="display:flex;"><span>read only       = false
</span></span><span style="display:flex;"><span>write only      = no
</span></span><span style="display:flex;"><span>list            = yes
</span></span><span style="display:flex;"><span>incoming chmod  = 0644
</span></span><span style="display:flex;"><span>outgoing chmod  = 0644
</span></span><span style="display:flex;"><span>max connections = 25
</span></span><span style="display:flex;"><span>lock file =     /var/lock/object.lock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[swift_server]
</span></span><span style="display:flex;"><span>path            = /etc/swift
</span></span><span style="display:flex;"><span>read only       = true
</span></span><span style="display:flex;"><span>write only      = no
</span></span><span style="display:flex;"><span>list            = yes
</span></span><span style="display:flex;"><span>incoming chmod  = 0644
</span></span><span style="display:flex;"><span>outgoing chmod  = 0644
</span></span><span style="display:flex;"><span>max connections = 5
</span></span><span style="display:flex;"><span>lock file =     /var/lock/swift_server.lock
</span></span><span style="display:flex;"><span># swift 서비스관련 파일을 수정합니다.
</span></span></code></pre></div><h1 id="heading-97">
  
  <a class="anchor" href="#heading-97">#</a>
</h1>
<ul>
<li><strong>compute 노드에서 disk 설정을 진행합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mkfs.xfs -i size=1024 -s size=4096 /dev/sdb1
</span></span><span style="display:flex;"><span>meta-data=/dev/sdc1              isize=1024   agcount=4, agsize=6553536 blks
</span></span><span style="display:flex;"><span>         =                       sectsz=4096  attr=2, projid32bit=1
</span></span><span style="display:flex;"><span>         =                       crc=1        finobt=0, sparse=0
</span></span><span style="display:flex;"><span>data     =                       bsize=4096   blocks=26214144, imaxpct=25
</span></span><span style="display:flex;"><span>         =                       sunit=0      swidth=0 blks
</span></span><span style="display:flex;"><span>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
</span></span><span style="display:flex;"><span>log      =internal log           bsize=4096   blocks=12799, version=2
</span></span><span style="display:flex;"><span>         =                       sectsz=4096  sunit=1 blks, lazy-count=1
</span></span><span style="display:flex;"><span>realtime =none                   extsz=4096   blocks=0, rtextents=0
</span></span><span style="display:flex;"><span># 디스크의 xfs의 유형으로 포맷시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ mkdir -p /srv/node/device0
</span></span><span style="display:flex;"><span>$ mount -o noatime,nodiratime,nobarrier /dev/sdc1 /srv/node/device0
</span></span><span style="display:flex;"><span>$ chown -R swift. /srv/node
</span></span><span style="display:flex;"><span># device0 디렉토리를 생성하고 해당 디렉토리에 sdb1 볼륨을 마운트시킨 후, swift로 소유권을 변경시킵니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/fstab
</span></span><span style="display:flex;"><span>/dev/sdc1     /srv/node/device0     xfs     noatime,nodiratime,nobarrier 0 0
</span></span><span style="display:flex;"><span># 재부팅할 경우를 대비하여 생성한 볼륨을 fstab에 등록합니다.
</span></span></code></pre></div><h1 id="heading-98">
  
  <a class="anchor" href="#heading-98">#</a>
</h1>
<p> </p>
<h1 id="heading-99">
  
  <a class="anchor" href="#heading-99">#</a>
</h1>
<ul>
<li><strong>selinux 및 방화벽 관련 서비스를 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ semanage fcontext -a -t swift_data_t /srv/node/device0
</span></span><span style="display:flex;"><span>$ restorecon /srv/node/device0
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=<span style="color:#75715e">{</span><span style="color:#ae81ff">873</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6200</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6201</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">6202</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#75715e">}</span> --permanent 
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload 
</span></span></code></pre></div><h1 id="heading-100">
  
  <a class="anchor" href="#heading-100">#</a>
</h1>
<ul>
<li><strong>swift 관련 서비스를 재시작합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ systemctl restart rsyncd openstack-swift-account-auditor openstack-swift-account-replicator openstack-swift-account openstack-swift-container-auditor openstack-swift-container-replicator openstack-swift-container-updater openstack-swift-container openstack-swift-object-auditor openstack-swift-object-replicator openstack-swift-object-updater openstack-swift-object
</span></span><span style="display:flex;"><span>$ systemctl enable rsyncd openstack-swift-account-auditor openstack-swift-account-replicator openstack-swift-account openstack-swift-container-auditor openstack-swift-container-replicator openstack-swift-container-updater openstack-swift-container openstack-swift-object-auditor openstack-swift-object-replicator openstack-swift-object-updater openstack-swift-object
</span></span></code></pre></div><h1 id="heading-101">
  
  <a class="anchor" href="#heading-101">#</a>
</h1>
<ul>
<li><strong>확인을 위해 controller 노드에 httpd를 재시작합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ systemctl restart httpd
</span></span><span style="display:flex;"><span># 대시보드 접속 후 프로젝트에서 오브젝트 스토리지가 메뉴에 있는 지를 확인합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack container create test
</span></span><span style="display:flex;"><span>+---------------------------------------+-----------+------------------------------------+
</span></span><span style="display:flex;"><span>| account                               | container | x-trans-id                         |
</span></span><span style="display:flex;"><span>+---------------------------------------+-----------+------------------------------------+
</span></span><span style="display:flex;"><span>| AUTH_2ac06290d2d943d5a768fe3daa53b118 | test      | tx22f3dd125f134a189602c-005f24cef1 |
</span></span><span style="display:flex;"><span>+---------------------------------------+-----------+------------------------------------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ echo Hello &gt; test.txt
</span></span><span style="display:flex;"><span>$ swift upload test test.txt
</span></span><span style="display:flex;"><span>$ swift list
</span></span><span style="display:flex;"><span>test
</span></span><span style="display:flex;"><span>$ swift list test
</span></span><span style="display:flex;"><span>test.txt
</span></span></code></pre></div><h1 id="heading-102">
  
  <a class="anchor" href="#heading-102">#</a>
</h1>
<p> </p>
<h1 id="heading-103">
  
  <a class="anchor" href="#heading-103">#</a>
</h1>
<h3 id="10-heat--orchestration--설치">
  <strong>10. Heat ( Orchestration ) 설치</strong>
  <a class="anchor" href="#10-heat--orchestration--%ec%84%a4%ec%b9%98">#</a>
</h3>
<h1 id="heading-104">
  
  <a class="anchor" href="#heading-104">#</a>
</h1>
<ul>
<li><strong>클라우딩 컴퓨팅이 꽃인 Orchestaration 기능을 수행하는 Heat 서비스를 설치해보도록 하겠습니다.</strong></li>
<li><strong>Heat 설치는 controller, network 노드 순으로 우리어집니다.</strong></li>
<li><strong>Heat*에 대한 설명은 <a href="https://mung0001.github.io/docs/study/openstack/heat/">Heat</a>을 참조해주세요.</strong></li>
</ul>
<h1 id="heading-105">
  
  <a class="anchor" href="#heading-105">#</a>
</h1>
<ul>
<li><strong>Heat 서비스 생성</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-heat-common python-heatclient
</span></span><span style="display:flex;"><span># heat 서비스 관련 패키지를 다운로드 합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack user create --domain default --project service --password qwer1234 heat
</span></span><span style="display:flex;"><span>$ openstack role add --project service --user heat admin
</span></span><span style="display:flex;"><span>$ openstack role create heat_stack_owner
</span></span><span style="display:flex;"><span>$ openstack role create heat_stack_user
</span></span><span style="display:flex;"><span>$ openstack role add --project admin --user admin heat_stack_owner
</span></span><span style="display:flex;"><span>$ openstack service create --name heat --description &#34;Openstack Orchestration&#34; orchestration
</span></span><span style="display:flex;"><span>$ openstack service create --name heat-cfn --description &#34;Openstack Orchestration&#34; cloudformation
</span></span><span style="display:flex;"><span># heat 유저를 생성하고 관리자의 권한을 부여합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export heat_api=10.10.10.20
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne orchestration public http://$heat_api:8004/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne orchestration internal http://$heat_api:8004/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne orchestration admin http://$heat_api:8004/v1/AUTH_%\(tenant_id\)s
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne cloudformation public http://$heat_api:8000/v1
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne cloudformation internal http://$heat_api:8000/v1
</span></span><span style="display:flex;"><span>$ openstack endpoint create --region RegionOne cloudformation admin http://$heat_api:8000/v1
</span></span><span style="display:flex;"><span># heat 서비스의 endpoint를 등록합니다. 여기서 proxy 서버는 네트워크 노드를 등록합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ openstack domain create --description &#34;Stack projects and users&#34; heat
</span></span><span style="display:flex;"><span>$ openstack user create --domain heat --password qwer1234 heat_domain_admin
</span></span><span style="display:flex;"><span>$ openstack role add --domain heat --user heat_domain_admin admin
</span></span><span style="display:flex;"><span># heat domain을 생성하고 heat 유저에게 권한을 부여합니다.
</span></span></code></pre></div><h1 id="heading-106">
  
  <a class="anchor" href="#heading-106">#</a>
</h1>
<ul>
<li><strong>heat의 DB를 생성합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ mysql -u root -p
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; create database heat;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on heat.* to heat@&#39;localhost&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; grant all privileges on heat.* to keystone@&#39;%&#39; identified by &#39;pw&#39;;
</span></span><span style="display:flex;"><span>MariaDB [(none)]&gt; flush privileges;
</span></span><span style="display:flex;"><span># heat DB를 생성합니다. 여기서 pw는 qwer1234으로 모두 통일하였습니다.
</span></span></code></pre></div><h1 id="heading-107">
  
  <a class="anchor" href="#heading-107">#</a>
</h1>
<ul>
<li><strong>이어서 network 노드에서 heat 서비스를 설치해보겠습니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-heat-api openstack-heat-api-cfn openstack-heat-engine python-heatclient
</span></span><span style="display:flex;"><span># heat 서비스를 위한 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/heat/heat.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>deferred_auth_method = trusts
</span></span><span style="display:flex;"><span>trusts_delegated_roles = heat_stack_owner
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Heat installed server
</span></span><span style="display:flex;"><span>heat_metadata_server_url = http://network:8000
</span></span><span style="display:flex;"><span>heat_waitcondition_server_url = http://network:8000/v1/waitcondition
</span></span><span style="display:flex;"><span>heat_watch_server_url = http://network:8003
</span></span><span style="display:flex;"><span>heat_stack_user_role = heat_stack_user
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Heat domain name
</span></span><span style="display:flex;"><span>stack_user_domain_name = heat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Heat domain admin name
</span></span><span style="display:flex;"><span>stack_domain_admin = heat_domain_admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Heat domain admin&#39;s password
</span></span><span style="display:flex;"><span>stack_domain_admin_password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># RabbitMQ connection info
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># MariaDB connection info
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://heat:qwer1234@controller/heat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Keystone auth info
</span></span><span style="display:flex;"><span>[clients_keystone]
</span></span><span style="display:flex;"><span>auth_uri = http://controller:5000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Keystone auth info
</span></span><span style="display:flex;"><span>[ec2authtoken]
</span></span><span style="display:flex;"><span>auth_uri = http://controller:5000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[heat_api]
</span></span><span style="display:flex;"><span>bind_host = 0.0.0.0
</span></span><span style="display:flex;"><span>bind_port = 8004
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[heat_api_cfn]
</span></span><span style="display:flex;"><span>bind_host = 0.0.0.0
</span></span><span style="display:flex;"><span>bind_port = 8000
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Keystone auth info
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = heat
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[trustee]
</span></span><span style="display:flex;"><span>auth_plugin = password
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>username = heat
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span># heat.conf 파일을 수정합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/bash heat -c &#34;heat-manage db_sync&#34;
</span></span><span style="display:flex;"><span>$ systemctl start openstack-heat-api openstack-heat-api-cfn openstack-heat-engine
</span></span><span style="display:flex;"><span>$ systemctl enable openstack-heat-api openstack-heat-api-cfn openstack-heat-engine
</span></span><span style="display:flex;"><span># DB의 데이터를 삽입하고, 서비스슬 등록합니다.
</span></span></code></pre></div><h1 id="heading-108">
  
  <a class="anchor" href="#heading-108">#</a>
</h1>
<ul>
<li><strong>방화벽을 사용중이면 방화벽을 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ firewall-cmd --add-port=<span style="color:#75715e">{</span><span style="color:#ae81ff">8000</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">8004</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#75715e">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span></code></pre></div><h1 id="heading-109">
  
  <a class="anchor" href="#heading-109">#</a>
</h1>
<p> </p>
<h1 id="heading-110">
  
  <a class="anchor" href="#heading-110">#</a>
</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ yum --enablerepo=centos-openstack-stein,epel -y install openstack-designate-api openstack-designate-central openstack-designate-worker openstack-designate-producer openstack-designate-mdns python-designateclient bind bind-utils
</span></span><span style="display:flex;"><span>#  서비스 관련 패키지를 설치합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ rndc-confgen -a -k designate -c /etc/designate.key -r /dev/urandom
</span></span><span style="display:flex;"><span>$ chown named:designate /etc/designate.key
</span></span><span style="display:flex;"><span>$ chmod 640 /etc/designate.key
</span></span><span style="display:flex;"><span># key를 생성합니다.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/named.conf
</span></span><span style="display:flex;"><span># create new
</span></span><span style="display:flex;"><span>options <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">listen</span><span style="color:#f92672">-</span><span style="color:#a6e22e">on</span> <span style="color:#a6e22e">port</span> <span style="color:#ae81ff">53</span> <span style="color:#75715e">{</span> <span style="color:#a6e22e">any</span><span style="color:#f92672">;</span> <span style="color:#75715e">}</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">listen</span><span style="color:#f92672">-</span><span style="color:#a6e22e">on</span><span style="color:#f92672">-</span><span style="color:#a6e22e">v6</span> <span style="color:#a6e22e">port</span> <span style="color:#ae81ff">53</span> <span style="color:#75715e">{</span> <span style="color:#a6e22e">none</span><span style="color:#f92672">;</span> <span style="color:#75715e">}</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">directory</span>       <span style="color:#e6db74">&#34;/var/named&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">dump</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span>       <span style="color:#e6db74">&#34;/var/named/data/cache_dump.db&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">statistics</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;/var/named/data/named_stats.txt&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memstatistics</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;/var/named/data/named_mem_stats.txt&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">replace</span> <span style="color:#a6e22e">query</span> <span style="color:#a6e22e">range</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">own</span> <span style="color:#a6e22e">environment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">query</span>     <span style="color:#75715e">{</span> <span style="color:#a6e22e">localhost</span><span style="color:#f92672">;</span> <span style="color:#ae81ff">10.10</span><span style="color:#f92672">.</span><span style="color:#ae81ff">10.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span><span style="color:#f92672">;</span> <span style="color:#75715e">}</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">new</span><span style="color:#f92672">-</span><span style="color:#a6e22e">zones</span> <span style="color:#a6e22e">yes</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">request</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ixfr</span> <span style="color:#a6e22e">no</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">recursion</span> <span style="color:#a6e22e">no</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">bindkeys</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;/etc/named.iscdlv.key&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">managed</span><span style="color:#f92672">-</span><span style="color:#a6e22e">keys</span><span style="color:#f92672">-</span><span style="color:#a6e22e">directory</span> <span style="color:#e6db74">&#34;/var/named/dynamic&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pid</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;/run/named/named.pid&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">session</span><span style="color:#f92672">-</span><span style="color:#a6e22e">keyfile</span> <span style="color:#e6db74">&#34;/run/named/session.key&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>;
</span></span><span style="display:flex;"><span>include &#34;/etc/designate.key&#34;;
</span></span><span style="display:flex;"><span>controls <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">inet</span> <span style="color:#ae81ff">0.0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.0</span> <span style="color:#a6e22e">port</span> <span style="color:#ae81ff">953</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">allow</span> <span style="color:#75715e">{</span> <span style="color:#a6e22e">localhost</span><span style="color:#f92672">;</span> <span style="color:#75715e">}</span> <span style="color:#a6e22e">keys</span> <span style="color:#75715e">{</span> <span style="color:#e6db74">&#34;designate&#34;</span><span style="color:#f92672">;</span> <span style="color:#75715e">}</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>;
</span></span><span style="display:flex;"><span>logging <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">channel</span> <span style="color:#a6e22e">default_debug</span> <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;data/named.run&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">severity</span> <span style="color:#a6e22e">dynamic</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">}</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>;
</span></span><span style="display:flex;"><span>zone &#34;.&#34; IN <span style="color:#75715e">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span> <span style="color:#a6e22e">hint</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">file</span> <span style="color:#e6db74">&#34;named.ca&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">}</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chown -R named. /var/named
</span></span><span style="display:flex;"><span>$ systemctl start named
</span></span><span style="display:flex;"><span>$ systemctl enable naemd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/designate/designate.conf
</span></span><span style="display:flex;"><span>[DEFAULT]
</span></span><span style="display:flex;"><span>log_dir = /var/log/designate
</span></span><span style="display:flex;"><span>transport_url = rabbit://openstack:qwer1234@controller
</span></span><span style="display:flex;"><span>root_helper = sudo designate-rootwrap /etc/designate/rootwrap.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[database]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://heat:qwer1234@controller/heat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[service:api]
</span></span><span style="display:flex;"><span>listen = 0.0.0.0:9001
</span></span><span style="display:flex;"><span>auth_strategy = keystone
</span></span><span style="display:flex;"><span>api_base_uri = http://controller:9001
</span></span><span style="display:flex;"><span>enable_api_v2 = True
</span></span><span style="display:flex;"><span>enabled_extensions_v2 = quotas, reports
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[keystone_authtoken]
</span></span><span style="display:flex;"><span>www_authenticate_uri = http://controller:5000
</span></span><span style="display:flex;"><span>auth_url = http://controller:5000
</span></span><span style="display:flex;"><span>memcached_servers = controller:11211
</span></span><span style="display:flex;"><span>auth_type = password
</span></span><span style="display:flex;"><span>project_domain_name = default
</span></span><span style="display:flex;"><span>user_domain_name = default
</span></span><span style="display:flex;"><span>project_name = service
</span></span><span style="display:flex;"><span>username = heat
</span></span><span style="display:flex;"><span>password = qwer1234
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[service:worker]
</span></span><span style="display:flex;"><span>enabled = True
</span></span><span style="display:flex;"><span>notify = True
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[storage:sqlalchemy]
</span></span><span style="display:flex;"><span>connection = mysql+pymysql://heat:qwer1234@controller/heat
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/sh -c &#34;designate-manage database sync&#34; designate
</span></span><span style="display:flex;"><span>$ systemctl start designate-central designate-api
</span></span><span style="display:flex;"><span>$ systemctl enable designate-central designate-api
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ vi /etc/designate/pools.yaml
</span></span><span style="display:flex;"><span># create new (replace hostname and IP address to your own environment)
</span></span><span style="display:flex;"><span>- name: default
</span></span><span style="display:flex;"><span>  description: Default Pool
</span></span><span style="display:flex;"><span>  attributes: <span style="color:#75715e">{}</span>
</span></span><span style="display:flex;"><span>  ns_records:
</span></span><span style="display:flex;"><span>    - hostname: network.srv.world.
</span></span><span style="display:flex;"><span>      priority: 1
</span></span><span style="display:flex;"><span>  nameservers:
</span></span><span style="display:flex;"><span>    - host: 10.10.10.20
</span></span><span style="display:flex;"><span>      port: 53
</span></span><span style="display:flex;"><span>  targets:
</span></span><span style="display:flex;"><span>    - type: bind9
</span></span><span style="display:flex;"><span>      description: BIND9 Server
</span></span><span style="display:flex;"><span>      masters:
</span></span><span style="display:flex;"><span>        - host: 10.10.10.20
</span></span><span style="display:flex;"><span>          port: 5354
</span></span><span style="display:flex;"><span>      options:
</span></span><span style="display:flex;"><span>        host: 10.10.10.20
</span></span><span style="display:flex;"><span>        port: 53
</span></span><span style="display:flex;"><span>        rndc_host: 10.10.10.20
</span></span><span style="display:flex;"><span>        rndc_port: 953
</span></span><span style="display:flex;"><span>        rndc_key_file: /etc/designate.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ su -s /bin/sh -c &#34;designate-manage pool update&#34; designate
</span></span><span style="display:flex;"><span>Updating Pools Configuration
</span></span><span style="display:flex;"><span>$ systemctl start designate-worker designate-producer designate-mdns
</span></span><span style="display:flex;"><span>$ systemctl enable designate-worker designate-producer designate-mdns
</span></span></code></pre></div><h1 id="heading-111">
  
  <a class="anchor" href="#heading-111">#</a>
</h1>
<ul>
<li><strong>이어서 selinux와 방화벽을 설정합니다.</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tpl" data-lang="tpl"><span style="display:flex;"><span>$ setsebool -P named_write_master_zones on
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-service=dns --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --add-port=<span style="color:#75715e">{</span><span style="color:#ae81ff">5354</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#f92672">,</span><span style="color:#ae81ff">9001</span><span style="color:#f92672">/</span><span style="color:#a6e22e">tcp</span><span style="color:#75715e">}</span> --permanent
</span></span><span style="display:flex;"><span>$ firewall-cmd --reload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>controller&gt; $openstack dns service list
</span></span><span style="display:flex;"><span># 확인
</span></span></code></pre></div><h1 id="heading-112">
  
  <a class="anchor" href="#heading-112">#</a>
</h1>
<p> </p>
<h1 id="heading-113">
  
  <a class="anchor" href="#heading-113">#</a>
</h1>
<p> </p>
<h1 id="heading-114">
  
  <a class="anchor" href="#heading-114">#</a>
</h1>
<h3 id="11-openstack-대시보드-메인-로고-및-링크-변경">
  <strong>11. Openstack 대시보드 메인 로고 및 링크 변경</strong>
  <a class="anchor" href="#11-openstack-%eb%8c%80%ec%8b%9c%eb%b3%b4%eb%93%9c-%eb%a9%94%ec%9d%b8-%eb%a1%9c%ea%b3%a0-%eb%b0%8f-%eb%a7%81%ed%81%ac-%eb%b3%80%ea%b2%bd">#</a>
</h3>
<h1 id="heading-115">
  
  <a class="anchor" href="#heading-115">#</a>
</h1>
<p> </p>
<h1 id="heading-116">
  
  <a class="anchor" href="#heading-116">#</a>
</h1>
<h3 id="12-neutron-기반-service-functon-chaining--sfc--기능-구성">
  <strong>12. Neutron 기반 Service Functon Chaining ( SFC ) 기능 구성</strong>
  <a class="anchor" href="#12-neutron-%ea%b8%b0%eb%b0%98-service-functon-chaining--sfc--%ea%b8%b0%eb%8a%a5-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<h1 id="heading-117">
  
  <a class="anchor" href="#heading-117">#</a>
</h1>
<p> </p>
<h1 id="heading-118">
  
  <a class="anchor" href="#heading-118">#</a>
</h1>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside style="max-width: 14%;" class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-시스템-및-네트워크-구성"><strong>1. 시스템 및 네트워크 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#2-openstack-기본-패키지-구성"><strong>2. Openstack 기본 패키지 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#3-keystone--인증-서비스--구성"><strong>3. Keystone ( 인증 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#4-glance--이미지-서비스--구성"><strong>4. Glance ( 이미지 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#5-nova--컴퓨트-서비스--구성"><strong>5. Nova ( 컴퓨트 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#6-neutron--네트워크-서비스--구성"><strong>6. Neutron ( 네트워크 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#7-horizon--대시보드-서비스--구성"><strong>7. Horizon ( 대시보드 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-cinder--오브젝트-스토리지-및-블록-스토리지-구성-"><strong>8. Cinder ( 오브젝트 스토리지 및 블록 스토리지 구성 )</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-2-lvm으로-블록-스토리지-백엔드-구성"><strong>8-2. LVM으로 블록 스토리지 백엔드 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-3-lbaas-설치"><strong>8-3. LBaaS 설치</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#8-4-lfs-lvm-기반-다중-스토리지-노드-구성"><strong>8-4. LFS, LVM 기반 다중 스토리지 노드 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#9-swift--오브젝트-스토리지-서비스--구성"><strong>9. Swift ( 오브젝트 스토리지 서비스 ) 구성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#10-heat--orchestration--설치"><strong>10. Heat ( Orchestration ) 설치</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#11-openstack-대시보드-메인-로고-및-링크-변경"><strong>11. Openstack 대시보드 메인 로고 및 링크 변경</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#12-neutron-기반-service-functon-chaining--sfc--기능-구성"><strong>12. Neutron 기반 Service Functon Chaining ( SFC ) 기능 구성</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>
</div>
</html>














