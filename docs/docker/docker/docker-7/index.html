<!DOCTYPE html>
<html lang="en">

<head>
  <script data-ad-client="ca-pub-1022327295984162" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Docker Swarm     Swarm은 Docker와 별개로 개발되었지만 Docker 1.12 버전부터 Swarm mode라는 이름으로 합쳐졌습니다.
  도커에 모든 게 내장되어 다른 툴을 설치할 필요가 없고 도커 명령어와 compose를 그대로 사용할 수 있어 다른 툴에 비해 압도적으로 쉬우며 편리합니다.
  기능이 단순하고 필요한 것만 구현되어 있어 세부적인 컨트롤의 난이도는 높은 편입니다.
     Docker Swarm 용어절리   Swarm   정식 명칭은 도커 1.">



<meta name="robots" content="index,follow">
<link rel="canonical" href=/docs/docker/docker/docker-7/><meta property="og:title" content="Docker Swarm" />
<meta property="og:description" content="Docker Swarm     Swarm은 Docker와 별개로 개발되었지만 Docker 1.12 버전부터 Swarm mode라는 이름으로 합쳐졌습니다.
  도커에 모든 게 내장되어 다른 툴을 설치할 필요가 없고 도커 명령어와 compose를 그대로 사용할 수 있어 다른 툴에 비해 압도적으로 쉬우며 편리합니다.
  기능이 단순하고 필요한 것만 구현되어 있어 세부적인 컨트롤의 난이도는 높은 편입니다.
     Docker Swarm 용어절리   Swarm   정식 명칭은 도커 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mung0001.github.io/docs/docker/docker/docker-7/" />


<title>뭉게뭉게</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.63eb88daa545365405ecdbb21033286a325c60a36cfa6d22d21e7c3bc9286941.css" integrity="sha256-Y&#43;uI2qVFNlQF7NuyEDMoajJcYKNs&#43;m0i0h58O8koaUE=">
<script defer src="/en.search.min.8a2c018e0f2810f098e576385b106c4d893d66c9ff8f57a1f6837bd03ade2e5d.js" integrity="sha256-iiwBjg8oEPCY5XY4WxBsTYk9Zsn/j1eh9oN70DreLl0="></script>
<!--

-->

  
</head>

<body>
  <div class="background">
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex" style="max-width:100%;" >
    <aside style="padding: 1.5%; max-width: 90%;" class="book-menu">
      
  
<nav styles="background-color:red; position=none;">
구름이 
<h2 class="book-brand">
  <a href="/"><span>뭉게뭉게</span>
  </a>
</h2>


<div style="padding-top: 0.2cm; font-size: 0.9em; font-weight: bolder;">
  <div style ="padding-bottom: 0.3cm;">
    Name : Jengkeun Lee
  </div>
  <div style ="padding-bottom: 0.3cm;">
    Mail : mung0001@naver.com
  </div>
</div>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  

  
  




 
  
    




  
  <ul>
    
      
        

  <li class="book-section-flat" >
    

  
  <a href="/docs/aws/" class="">Amazon Web Services</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/aws/amazonwebservice/" class="collapsed ">AWS docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/aws/awstraining/" class="collapsed ">AWS Training</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/aws/awssaa/" class="collapsed ">AWS SAA 시험정리</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Microsoft Azure</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/azure/microsoftazure/" class="collapsed ">Azure docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/azure/azuretraining/" class="collapsed ">Azure Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Google Cloud Platform</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/gcp/googlecloudplatform/" class="collapsed ">GCP docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/gcp/gcptraining/" class="collapsed ">GCP Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Naver Cloud Platform</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/ncp/navercloudplatform/" class="collapsed ">NCP docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/ncp/ncptraining/" class="collapsed ">NCP Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>OpenStack</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/openstack/openstack/" class="collapsed ">OpenStack docs</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/openstack/openstacktraining/" class="collapsed ">OpenStack Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Docker</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/docker/docker/" class="collapsed ">Docker docs</a>
  


    




  
  <ul>
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-1/" class="">Docker란?</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-2/" class="">Docker 환경구축</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-3/" class="">Docker 이미지와 컨테이너</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-4/" class="">Docker 기본 명령어</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-5/" class="">Dockerfile</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-6/" class="">Docker Compose</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-7/" class="active">Docker Swarm</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/base/" class="">Base</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-10/" class="">Docker 10</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-11/" class="">Docker 11</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-8/" class="">Docker 8</a>
  

</li>
      
    
      
        <li >

  
  <a href="/docs/docker/docker/docker-9/" class="">Docker 9</a>
  

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/docker/dockertraining/" class="collapsed ">Docker Training</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Programming</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/programing/python/" class="collapsed ">Python</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/programing/shell/" class="collapsed ">Shell Script</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/programing/golang/" class="collapsed ">Golang</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/programing/web/" class="collapsed ">Web</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/programing/git/" class="collapsed ">Git</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Network</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/network/network/" class="collapsed ">Network 기본</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/network/snort/" class="collapsed ">Snort</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/network/mail/" class="collapsed ">Mail</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/network/%EC%A0%95%EB%A6%AC%EC%A0%84/" class="collapsed ">정리전</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/network/sophos/" class="collapsed ">Sophos</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>System</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/system/nas/" class="collapsed ">NAS</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/linux/" class="collapsed ">Linux</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/docs/system/lm/" class="collapsed ">Linux master</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Database</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/database/sqld/" class="collapsed ">SQLP&amp; SQLD</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li class="book-section-flat" >
    

  
  <span>Project</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/docs/project/mini/" class="collapsed ">M Ini</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  














  
<ul>
  
  <li>
    <a href="/posts/" >
        Blog
      </a>
  </li>
  
</ul>







</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div style="padding-left: 2.5%;" class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Docker Swarm</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#docker-swarm"><strong>Docker Swarm</strong></a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-용어절리"><strong>Docker Swarm 용어절리</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#도커-스윔이-제공하는-기능"><strong>도커 스윔이 제공하는 기능</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-실습"><strong>Docker Swarm 실습</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-scale"><strong>Docker Swarm scale</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#방문자-수-체크-웹-애플리케이션-생성"><strong>방문자 수 체크 웹 애플리케이션 생성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#비밀키-조회-애플리케이션"><strong>비밀키 조회 애플리케이션</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#traefik-리버스-프록시-서버"><strong>Traefik 리버스 프록시 서버</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>



    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="docker-swarm"><strong>Docker Swarm</strong></h2>
<hr>
<h1 id="heading"></h1>
<ul>
<li>
<p><strong>Swarm은 Docker와 별개로 개발되었지만 Docker 1.12 버전부터 Swarm mode라는 이름으로 합쳐졌습니다.</strong></p>
</li>
<li>
<p><strong>도커에 모든 게 내장되어 다른 툴을 설치할 필요가 없고 도커 명령어와 compose를 그대로 사용할 수 있어 다른 툴에 비해 압도적으로 쉬우며 편리합니다.</strong></p>
</li>
<li>
<p><strong>기능이 단순하고 필요한 것만 구현되어 있어 세부적인 컨트롤의 난이도는 높은 편입니다.</strong></p>
</li>
</ul>
<h1 id="heading-1"></h1>
<p> </p>
<h1 id="heading-2"></h1>
<h3 id="docker-swarm-용어절리"><strong>Docker Swarm 용어절리</strong></h3>
<h1 id="heading-3"></h1>
<ul>
<li><strong>Swarm</strong>
<ul>
<li>
<p><strong>정식 명칭은 도커 1.12버전에서 Swarm이 Swarm Mode로 바뀌었지만 그냥 Swarm이라고 하는 듯합니다.</strong></p>
</li>
<li>
<p><strong>Swarm Cluster자체도 Swarm이라고 합니다. Swarm을 만들다 = Cluster을 만들다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-4"></h1>
<p> </p>
<ul>
<li><strong>Node</strong>
<ul>
<li>
<p><strong>스웜 클러스트에 속한 도커 서버의 단위입니다.</strong></p>
</li>
<li>
<p><strong>기본적으로 한 서버에 하나의 도커 데몬만 실행하므로 서버가 곧 노드라 할 수 있으며, 노드에 종류에는 매니저 노드와 워커 노드가 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-5"></h1>
<p> </p>
<ul>
<li><strong>Manager node</strong>
<ul>
<li>
<p><strong>스웜 클러스트 상태를 관리하는 노드입니다.</strong></p>
</li>
<li>
<p><strong>매니저 노드는 곧 워커노드가 될 수 있고 스웜 명령어는 매니저 노드에서만 실행됩니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-6"></h1>
<p> </p>
<ul>
<li><strong>Worker node</strong>
<ul>
<li><strong>매니저 노드의 명령을 받아 컨테이너를 생성하고 상태를 체크하는 노드입니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-7"></h1>
<p> </p>
<ul>
<li><strong>Service</strong>
<ul>
<li><strong>기본적인 배포 단위로 하나의 서비스는 하나의 이미지를 기반으로 생성하고 동일한 컨테이너를 한 개 이상 실행할 수 있습니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-8"></h1>
<p> </p>
<ul>
<li><strong>task</strong>
<ul>
<li><strong>컨테이너 배포 단위로 하나의 서비스는 여러 개의 테스크를 실행할 수 있고 각각의 테스크가 컨테이너를 관리합니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-9"></h1>
<p> </p>
<h1 id="heading-10"></h1>
<h3 id="도커-스윔이-제공하는-기능"><strong>도커 스윔이 제공하는 기능</strong></h3>
<h1 id="heading-11"></h1>
<ul>
<li><strong>Scheduling</strong>
<ul>
<li>
<p><strong>서비스를 만들면 컨테이너를 워커노드에 배포합니다.</strong></p>
</li>
<li>
<p><strong>현재는 균등하게 배포하는 방식만 지원하며 추후 다른 배포 전략이 추가될 예정입니다.</strong></p>
</li>
<li>
<p><strong>노드에 라벨을 지정하여 특정 노드에만 배포할 수 있고 모든 서버에 한 대씩 배포하는 기능 또한 제공하며, 서비스별로 CPU, Memory 사용량을 미리 설정할 수 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-12"></h1>
<p> </p>
<ul>
<li><strong>High Available</strong>
<ul>
<li>
<p><strong>Raft 알고리즘을 이용하여 어러 개의 매니저노드를 운영할 수 있습니다.</strong></p>
</li>
<li>
<p><strong>3대를 사용하면 1대가 죽어도 클러스터는 정상적으로 동작하며 매니저 노드를 지저하는 방법은 간단하므로 쉽게 관리할 수 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-13"></h1>
<p> </p>
<ul>
<li><strong>Multi Host NEtwork</strong>
<ul>
<li>
<p><strong>Overlay Network로 불리는 SDN (Software Defined Networks)를 지원하여 여러 노드에 분산된 컨테이너를 하나의 네트워크로 묶을 수 있습니다.</strong></p>
</li>
<li>
<p><strong>컨테이너마다 독립된 IP가 생기고 서로 다른 노드에 있어도 할당된 IP로 통신할 수 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-14"></h1>
<p> </p>
<ul>
<li><strong>Service Discovey</strong>
<ul>
<li>
<p><strong>서비스 디스커버리를 이한 자체 DNS 서버를 가지고 있으며, 컨테이너를 생성하면 서비스명과 동일한 도메인을 등록하고 컨테이너가 멈추면 도메인을 제거합니다.</strong></p>
</li>
<li>
<p><strong>멀티 호스트 네트워크를 사용하면 여러 노드에 분산된 컨테이너가 같은 네트워크로 묶이므로 서비스 이름으로 바로 접근할 수 있습니다.</strong></p>
</li>
<li>
<p><strong>Consul이나 etcd, zookeeper와 같은 외부 서비스를 사용하지 않고 어떠한 추가 작업도 필요 없습니다. 스웜이 알아서 관리합니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-15"></h1>
<p> </p>
<ul>
<li><strong>Rolling Update</strong>
<ul>
<li>
<p><strong>서비스를 새로운 이미지로 업데이트하는 경우 하나하나 차례대로 업데이트를 진행합니다.</strong></p>
</li>
<li>
<p><strong>동시에 업데이트하는 작업의 개수와 업데이트 간격 시간을 조정할 수 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-16"></h1>
<p> </p>
<ul>
<li><strong>Heath Check</strong>
<ul>
<li>
<p><strong>서비스가 정상적으로 실행되었는지 확인하기 위해 컨테이너 실행 여부 뿐 특정 쉘 스크립트가 정상적으로 실행됐는지 여부를 추가로 체크할 수 있습니다.</strong></p>
</li>
<li>
<p><strong>컨테이너 실행 여부로만 체크할 경우 아직 서버가 실행 되지 않아 접소시 오류가 날 수 있는 미묘한 타이밍을 잡는 데 효과적입니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-17"></h1>
<p> </p>
<ul>
<li><strong>Secret Management</strong>
<ul>
<li>
<p><strong>비밀번호를 스웜 어딘가에 생성하고 컨테이너에서 읽는 것이 가능합니다.</strong></p>
</li>
<li>
<p><strong>비밀 값을 관리하기 위한 외부 서비스를 설치하지 않고 쉽게 사용할 수 있습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-18"></h1>
<p> </p>
<ul>
<li><strong>Logging</strong>
<ul>
<li>
<p><strong>같은 노드에서 실행 중인 컨테이너 뿐 아니라 다른 노드에서 실행 중인 서비스의 로그를 한 곳엣 볼 수 있습니다.</strong></p>
</li>
<li>
<p><strong>특정 서비스의 로그를 보려면 어느 노드에서 실행 중인지 알 필요도 없고 일일이 접속할 필요도 없습니다.</strong></p>
</li>
</ul>
</li>
</ul>
<h1 id="heading-19"></h1>
<p> </p>
<ul>
<li><strong>Monitoring</strong>
<ul>
<li><strong>리소스 모니터링 기능은 제공하지 않습니다. 3rd party (prometheus, grafana) 서비스를 사용해야 합니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-20"></h1>
<p> </p>
<ul>
<li><strong>Cron</strong>
<ul>
<li><strong>반복작업 Cron도 알아서 구현해야 합니다. 여러 가지 방식으로 해결할 수 있지만, 직접 제공하지 않아 아쉬운 부분입니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-21"></h1>
<p> </p>
<h1 id="heading-22"></h1>
<h3 id="docker-swarm-실습"><strong>Docker Swarm 실습</strong></h3>
<h1 id="heading-23"></h1>
<ul>
<li><strong>구성</strong>
<ul>
<li><strong>master node-1 cpu : 1 / RAM : 1024 / network : 10.10.10.10</strong></li>
<li><strong>worker node-2 cpu : 1 / RAM : 1024 / network : 10.10.10.11</strong></li>
<li><strong>worker node-3 cpu : 1 / RAM : 1024 / network : 10.10.10.12</strong></li>
<li><strong>저는 간단하게 EC2를 사용해서 만들었습니다.</strong></li>
</ul>
</li>
</ul>
<h1 id="heading-24"></h1>
<p> </p>
<h1 id="heading-25"></h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">$ (master : 10.10.10.10)&gt; sudo docker swarm leave --force
# 만약 에러 발생시

$ (master : 10.10.10.10)&gt; sudo docker swarm init --advertise-addr 10.10.10.10
Swarm initialized: current node (p1rci8vzzfkadh869wt7b80x6) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-1lgt56s4fa05qak31h5aets5gea88qon2ul91jhcfdwvjkzjvd-043z7ty8xxl3xhlidku07hzsn 10.10.10.10:2377

To add a manager to this swarm, run &#39;docker swarm join-token manager&#39; and follow the instructions.
# 토큰 값은 중요하니 복사해둡니다.

$ (worker : 10.10.10.11)&gt; sudo docker swarm join \
    --token SWMTKN-1-1lgt56s4fa05qak31h5aets5gea88qon2ul91jhcfdwvjkzjvd-043z7ty8xxl3xhlidku07hzsn \
    10.10.10.10:2377
This node joined a swarm as a worker.

$ (worker : 10.10.10.12)&gt; sudo docker swarm join \
    --token SWMTKN-1-1lgt56s4fa05qak31h5aets5gea88qon2ul91jhcfdwvjkzjvd-043z7ty8xxl3xhlidku07hzsn \
    10.10.10.10:2377
This node joined a swarm as a worker.

$ (master : 10.10.10.10)&gt; sudo docker node ls
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
p1rci8vzzfkadh869wt7b80x6 *   ip-10-10-10-10      Ready               Active              Leader              19.03.12
i3kp1hl9gbssf9bm2c7nmpl0k     ip-10-10-10-11      Ready               Active                                  19.03.12
ir4blo0hzuezyoakk0jrk8ul4     ip-10-10-10-12      Ready               Active                                  19.03.12
# 확인

$ (master : 10.10.10.10)&gt; sudo docker service create --name whoami \
  -p 4567:4567 \
  subicura/whoami:1
# 위둔 hostname을 출력하는 간단한 앱입니다.

$ (master : 10.10.10.10)&gt; sudo docker service list
ID                  NAME                MODE                REPLICAS            IMAGE               PORTS
zmdp77bnply5        whoami              replicated          1/1                 subicura/whoami:1   *:4567-&gt;4567/tcp
# image가 다운로드 완료되었습니다.

$ (master : 10.10.10.10)&gt; docker service ps whoami
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS
qzg94my1uk90        whoami.1            subicura/whoami:1   ip-10-10-10-10      Running             Running 4 minutes ago
# 컨테이너를 실행시킵니다.

$ (master : 10.10.10.10)&gt; curl localhost:4567
204bc4d6aa2c

$ (master : 10.10.10.10)&gt; curl 10.10.10.11:4567
204bc4d6aa2c
# 정상적으로 실행되고 있는 지 확인해봅니다.
</code></pre></div><ul>
<li>
<p><strong>위와 같이 도커스윔은 서비스를 외부에 쉽게 노출하기 위해 모든 노드가 Ingress라는 가상 네트어크에 속해 있습니다.</strong></p>
</li>
<li>
<p><strong>ingress는 routing mesh라는 재미있는 개념을 가지고 있는 데, 이 개념은 서비스가 포트를 오픈하 경우 모든 노드에 포트가 오픈되고 어떤 노드에 요청을 보내도 실행 중인 컨테이너에 자동으로 전달해 줍니다.</strong></p>
</li>
</ul>
<h1 id="heading-26"></h1>
<p> </p>
<h1 id="heading-27"></h1>
<h3 id="docker-swarm-scale"><strong>Docker Swarm scale</strong></h3>
<h1 id="heading-28"></h1>
<ul>
<li><strong>여기서는 Docker Swarm을 통해 서비스의 개수를 늘려보도록 하겠습니다.</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">$ (master : 10.10.10.10)&gt; sudo docker service scale whoami=5
whoami scaled to 5
overall progress: 5 out of 5 tasks
1/5: running   [==================================================&gt;]
2/5: running   [==================================================&gt;]
3/5: running   [==================================================&gt;]
4/5: running   [==================================================&gt;]
5/5: running   [==================================================&gt;]
verify: Service converged
# docker service의 범위를 5개까지 확장시킵니다.

$ (master : 10.10.10.10)&gt; sudo docker service ps whoami
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
qzg94my1uk90        whoami.1            subicura/whoami:1   ip-10-10-10-10      Running             Running 12 minutes ago
yb1ao89h9m0a        whoami.2            subicura/whoami:1   ip-10-10-10-11      Running             Running 28 seconds ago
8rqaj1fnh2ef        whoami.3            subicura/whoami:1   ip-10-10-10-12      Running             Running 26 seconds ago
0fmuy9nijyw3        whoami.4            subicura/whoami:1   ip-10-10-10-12      Running             Running 27 seconds ago
dsi6rogdtwvk        whoami.5            subicura/whoami:1   ip-10-10-10-10      Running             Running 38 seconds ago
# docker service를 시작합니다.

$ (master : 10.10.10.10)&gt; docker service ps whoami

$ (master : 10.10.10.10)&gt; curl localhsot:4567
# 자동으로 로드밸런서의 역할도 수행되는 것도 확인하실 수 있습니다.
</code></pre></div><ul>
<li>
<p><strong>Swarm은 컨테이너가 실행되면 ingress에서 해당 컨테이너로 요청을 보내기 시작하는 데, 웹 서버가 부팅되는 동안 문제가 발생할 수 있습니다.</strong></p>
</li>
<li>
<p><strong>하지만 만약 컨테이너가 완전히 실행되지 않았을 때 요청은 보낸 경우 에러가 발생할 수 있어 이를 해결하기 위해 상태체크 방식의 필요성이 대두되었습니다.</strong></p>
</li>
<li>
<p><strong>Docker 1.12버전에서 HEALTHCHECK 명령어를 추가되었고 쉘 스크립트를 작성하여 보다 정확한 상태의 체크가 가능해졌습니다.</strong></p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">HEALTHCHECK --interval=&lt;초s&gt; CMD wget -qO- &lt;IP:port&gt;
HEALTHCHECK --interval=10s CMD wget -qO- localhost:4567
# &lt;초&gt;마다 wget을 이용하여 &lt;IP:port&gt;를 체크하며 정상적인 경우 0을 리턴하는 데, 이 경우 정상이라 판단되고 그 떄 요청을 보내게 됩니다.

$ (master : 10.10.10.10)&gt; vi Dockerfile
FROM ruby:2.3-alpine
COPY Gemfile* /usr/src/app/
WORKDIR /usr/src/app
RUN bundle install
COPY . /usr/src/app
EXPOSE 4567
HEALTHCHECK --interval=10s CMD wget -qO- localhost:4567
CMD bundle exec ruby app.rb -o 0.0.0.0

$ (master : 10.10.10.10)&gt; docker service update \
--image subicura/whoami:2 \
whoami
1/5: running
2/5: running
3/5: running
4/5: running
5/5: running
verify: Service converged
# 이미지를 업데이트 합니다.

$ (master : 10.10.10.10)&gt; docker service ps whoami
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
enooa8xmaj2t        whoami.1            subicura/whoami:2   ip-10-10-10-10      Running             Running 2 minutes ago
qzg94my1uk90         \_ whoami.1        subicura/whoami:1   ip-10-10-10-10      Shutdown            Shutdown 2 minutes ago
oqfigt4i4mqy        whoami.2            subicura/whoami:2   ip-10-10-10-10      Running             Running 2 minutes ago
yb1ao89h9m0a         \_ whoami.2        subicura/whoami:1   ip-10-10-10-11      Shutdown            Shutdown 2 minutes ago
42bqor5clgbx        whoami.3            subicura/whoami:2   ip-10-10-10-12      Running             Running 3 minutes ago
8rqaj1fnh2ef         \_ whoami.3        subicura/whoami:1   ip-10-10-10-12      Shutdown            Shutdown 3 minutes ago
cyk132cxnfkt        whoami.4            subicura/whoami:2   ip-10-10-10-11      Running             Running 3 minutes ago
0fmuy9nijyw3         \_ whoami.4        subicura/whoami:1   ip-10-10-10-12      Shutdown            Shutdown 3 minutes ago
n61ei91lbs7o        whoami.5            subicura/whoami:2   ip-10-10-10-12      Running             Running 2 minutes ago
dsi6rogdtwvk         \_ whoami.5        subicura/whoami:1   ip-10-10-10-10      Shutdown            Shutdown 3 minutes ago
# Healthcheck를 확인 할 수 있습니다.
</code></pre></div><h1 id="heading-29"></h1>
<p> </p>
<h1 id="heading-30"></h1>
<h3 id="방문자-수-체크-웹-애플리케이션-생성"><strong>방문자 수 체크 웹 애플리케이션 생성</strong></h3>
<h1 id="heading-31"></h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">$ (master : 10.10.10.10)&gt; sudo docker network create --attachable \
  --driver overlay \
  backend
fvy3gx80r83h01d4h81488rs3
# 오버레이 네트워크를 생성합니다.

$ (master : 10.10.10.10)&gt; sudo docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
...
fvy3gx80r83h        backend             overlay             swarm
...
# 생성된 네트워크를 확인합니다.

$ (master : 10.10.10.10)&gt; sudo docker service create --name redis \
  --network=backend \
  redis
ikfn3m39hn3qrft3e5dx90oe2
# redis를 backend 네트워크로 생성합니다.

$ (master : 10.10.10.10)&gt; sudo docker service create --name counter \
  --network=backend \
  --replicas 3 \
  -e REDIS_HOST=redis \
  -p 4568:4567 \
  subicura/counter
mty90m5iq7n7dvsl4pdskx0ew
overall progress: 3 out of 3 tasks
1/3: running
2/3: running
3/3: running
verify: Service converged
# redis 서버와의 통신을 이해 backend 네트워크를 지정했으며 --replicas 옵션을 이용하여 3개의 서버를 사용하도록 만들었습니다.
# 4568 포트로 접근할 수 있도록 포트를 오픈 했고 redis 서버의 도메인명을 환경변수로 전달했습니다.

$ (master : 10.10.10.10)&gt; curl localhost:4568
$ (master : 10.10.10.10)&gt; curl localhost:4568
$ (master : 10.10.10.10)&gt; curl localhost:4568
# .... &gt; 1..2..3 순으로 증가하는 것을 확인하실 수 있습니다.
</code></pre></div><h1 id="heading-32"></h1>
<p> </p>
<h1 id="heading-33"></h1>
<h3 id="비밀키-조회-애플리케이션"><strong>비밀키 조회 애플리케이션</strong></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">$ (master : 10.10.10.10)&gt; echo &#34;this is my password!&#34; | docker secret create my-password -
1p5vcpdcii599ggu8bh4pdh91
# 비밀 키를 생성합니다.

$ (master : 10.10.10.10)&gt; sudo docker service create --name secret \
  --secret my-password \
  -p 4569:4567 \
  -e SECRET_PATH=/run/secrets/my-password \
  subicura/secret
# 입력된 키를 출력해주는 간단한 앱을 생성합니다.

$ (master : 10.10.10.10)&gt; curl localhost:4569
this is my password!
</code></pre></div><h1 id="heading-34"></h1>
<p> </p>
<h1 id="heading-35"></h1>
<h3 id="traefik-리버스-프록시-서버"><strong>Traefik 리버스 프록시 서버</strong></h3>
<ul>
<li>
<p><strong>스웜은 매니저 노드에서 모든 서비스를 관리할 수 있고 서비스가 생성된 것을 체크하면 무언가를 자동화할 수 있습니다.</strong></p>
</li>
<li>
<p><strong>Traefik은 이러한 아이디어를 이용해 웹 애플리케이션이 생성되면 자동으로 도메인을 만들고 내부 서비스로 연결해줍니다.</strong></p>
</li>
<li>
<p><strong>ex&gt; counter &ndash;&gt; counter.local.dev 도메인을 통해 저복</strong></p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">$ (master : 10.10.10.10)&gt; sudo docker network create --driver overlay frontend
tpj48hxfpu2jilp7uqphzt96m
# 프록시 연결하기 위해 frontend 라는 네트워크를 생성합니다.

$ (master : 10.10.10.10)&gt; sudo docker service create --name traefik \
  --constraint &#39;node.role == manager&#39; \
  -p 80:80 \
  -p 8080:8080 \
  --mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock \
  --network frontend \
  traefik \
  --docker \
  --docker.swarmmode \
  --docker.domain=local.dev \
  --docker.watch \
  --web
# --constraint 옵션은 매니저 노드에서 실행할 수 있게 배포를 제한합니다.
# --mount 옵션을 이용해 호스트의 도커 소켓을 마운트 하였습니다.
# 80은 실제 웹 서비스에 제공하기 위한 포트이며 8080은 관리자용 포트입니다.
# 접속하여 확인합니다.

$ (master : 10.10.10.10)&gt; sudo docker service create --name portainer \
  --network=frontend \
  --label traefik.port=9000 \
  --constraint &#39;node.role == manager&#39; \
  --mount &#34;type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock&#34; \
  portainer/portainer
# raefik과 접속할 수 있도록 frontend네트워크에 연결했고 --label옵션으로 내부적으로 사용하는 웹 포트를 알려주었습니다. traefik은 traefik.port라벨의 값을 읽어 해당 포트로 리버스 프록시를 연결합니다. portainer는 스웜을 관리해주는 툴이기 때문에 매니저 노드에 실행하도록 했습니다.

# 서비스 이름을 portainer로 했기 때문에 서비스가 실행되면 traefik서비스가 자동으로 portainer.local.dev도메인 정보를 생성하고 portainer컨테이너의 9000번 포트로 연결합니다. 서비스를 생성하고 잠시 기다리면 프록시 설정이 자동으로 완료됩니다.
</code></pre></div><h1 id="heading-36"></h1>
<p> </p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside style="max-width: 14%;" class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#docker-swarm"><strong>Docker Swarm</strong></a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-용어절리"><strong>Docker Swarm 용어절리</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#도커-스윔이-제공하는-기능"><strong>도커 스윔이 제공하는 기능</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-실습"><strong>Docker Swarm 실습</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#docker-swarm-scale"><strong>Docker Swarm scale</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#방문자-수-체크-웹-애플리케이션-생성"><strong>방문자 수 체크 웹 애플리케이션 생성</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#비밀키-조회-애플리케이션"><strong>비밀키 조회 애플리케이션</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#traefik-리버스-프록시-서버"><strong>Traefik 리버스 프록시 서버</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>


 
    </aside>
    
  </main>

  
</body>
</div>
</html>















